exports.id=5983,exports.ids=[5983],exports.modules={35303:()=>{},69486:(e,t,n)=>{"use strict";n.d(t,{Z:()=>k});var i=n(97247),a=n(99539);n(96116);var l=n(17082),r=n(39884),s=n(1880),d=n(65794),c=n(77951),o=n(61410),p=n(82140),h=n(12927),u=n(95718),m=n(35090),x=n(77709),j=n(69160),f=n(41201),y=n(75142),g=n(28964),v=n(98065),w=n(16523),_=n(23102),C=n(45018),N=n(57233),Z=n(34178);function k({refBtn:e,idOpportunity:t}){let{projectID:n}=(0,Z.useParams)(),k=(0,_.I0)(),{datas:S}=(0,_.v9)(e=>e.vat_system),W=(0,g.useRef)(),{datas:b}=(0,_.v9)(e=>e.get_projects),{datas:L}=(0,_.v9)(e=>e.info_products),{datas:I}=(0,_.v9)(e=>e.unit_product),{datas:V}=(0,_.v9)(e=>e.get_profits),{datas:T}=(0,_.v9)(e=>e.type_package),[q,A]=(0,g.useState)(0),[F,O]=(0,g.useState)("percent"),[P,M]=(0,g.useState)("none"),[$,B]=(0,g.useState)(0),[D,G]=(0,g.useState)([]),[R,z]=(0,g.useState)(0),[E,K]=(0,g.useState)(0),H=(0,i.jsxs)(r.Z,{defaultValue:"percent",onChange:e=>{O(e)},children:[i.jsx(f.W,{value:"percent",children:"%"}),i.jsx(f.W,{value:"money",children:"vnđ"})]}),Q=(e,t)=>{G(n=>n.map((n,i)=>i===e?{...n,products:n.products.map((n,i)=>i===t?{...n,key:i,children:n.children?[...n.children,{ikey:t,key:1e4*e+1e3*i+n.children.length+100,description:"",unit:"",quantity:1,price:0}]:[{ikey:t,key:1e4*e+1e3*i+100,description:"",unit:"",quantity:1,price:0}]}:n)}:n))},U=e=>[{title:"Loại sản phẩm",dataIndex:["type","name"],key:"type",render:(t,n,a)=>(0,i.jsxs)("div",{className:"flex gap-1 items-center",children:[n.name&&i.jsx(w.KVB,{className:"cursor-pointer text-lg",onClick:()=>{Q(e,a)}}),t]})},{title:"T\xean sản phẩm",dataIndex:"name",key:"name"},{title:"M\xf4 tả",dataIndex:"description",key:"description",render:(t,n,a)=>n.name?i.jsx(i.Fragment,{children:i.jsx("p",{children:t?.length>20?`${t.slice(0,20)}...`:t})}):i.jsx(i.Fragment,{children:i.jsx(s.default.TextArea,{placeholder:"M\xf4 tả chi tiết",value:t,onChange:t=>{G(i=>i.map((i,l)=>l===e?{...i,products:i.products.map((e,i)=>i===n?.ikey?{...e,children:e.children?.map((e,n)=>n===a?{...e,description:t.target.value}:e)}:e)}:i))},autoSize:{minRows:1}})})},{title:"Đơn vị",dataIndex:"unit",key:"unit",width:"100px",render:(t,n,a)=>n.name?i.jsx(i.Fragment,{children:n?.unit_product?.name_unit}):i.jsx(r.Z,{placeholder:"Chọn đơn vị",showSearch:!0,value:t,onChange:t=>{G(i=>i.map((i,l)=>l===e?{...i,products:i.products.map((e,i)=>i===n?.ikey?{...e,children:e.children?.map((e,n)=>n===a?{...e,unit:t}:e)}:e)}:i))},filterOption:(e,t)=>(t?.children?.join("")??"").toLowerCase().includes(e.toLowerCase()),children:I?.map(e=>i.jsx(f.W,{value:e.unit_id,children:e.name_unit},e.unit_id))})},{title:"Số lượng",dataIndex:"quantity",key:"quantity",width:"30px",render:(t,n,a)=>n.name?i.jsx(i.Fragment,{children:i.jsx(d.Z,{onChange:t=>{G(n=>n.map((n,i)=>i===e?{...n,products:n.products.map((e,n)=>n===a?{...e,quantity:t}:e)}:n))},min:1,value:t})}):i.jsx(d.Z,{min:1,value:t,onChange:t=>{G(i=>i.map((i,l)=>l===e?{...i,products:i.products.map((e,i)=>i===n?.ikey?{...e,children:e.children?.map((e,n)=>n===a?{...e,quantity:t??1}:e)}:e)}:i))}})},{title:"Gi\xe1 sản phẩm (VNĐ)",dataIndex:"price",key:"price",width:"120px",render:(t,n,a)=>i.jsx(i.Fragment,{children:i.jsx(d.Z,{placeholder:"Gi\xe1",onChange:t=>{n.name?G(n=>n.map((n,i)=>i===e?{...n,products:n.products.map((e,n)=>n===a?{...e,price:t}:e)}:n)):G(i=>i.map((i,l)=>l===e?{...i,products:i.products.map((e,i)=>i===n?.ikey?{...e,children:e.children?.map((e,n)=>n===a?{...e,price:t??1}:e)}:e)}:i))},className:"w-full",defaultValue:t,formatter:e=>`${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e?.replace(/\$\s?|(,*)/g,"")})})},{title:"Thuế VAT",dataIndex:"vat",key:"vat",width:"30px",render:(t,n,a)=>{if(n.name)return i.jsx(i.Fragment,{children:i.jsx(r.Z,{placeholder:"Chọn loại thuế",showSearch:!0,defaultValue:t,onChange:t=>{G(n=>n.map((n,i)=>i===e?{...n,products:n.products.map((e,n)=>n===a?{...e,vat:t}:e)}:n))},filterOption:(e,t)=>(t?.children?.join("")??"").toLowerCase().includes(e.toLowerCase()),children:S?.map(e=>i.jsxs(f.W,{value:e.vat_id,children:[e.type_vat,"%"]},e.vat_id))})})}},{title:"Lợi nhuận",dataIndex:"profit",key:"profit",width:"30px",render:(t,n,a)=>{if(n.name)return i.jsx(i.Fragment,{children:i.jsx(r.Z,{placeholder:"Chọn loại thuế",showSearch:!0,defaultValue:t,onChange:t=>{G(n=>n.map((n,i)=>i===e?{...n,products:n.products.map((e,n)=>n===a?{...e,profit:t}:e)}:n))},filterOption:(e,t)=>(t?.children?.join("")??"").toLowerCase().includes(e.toLowerCase()),children:V?.map(e=>i.jsxs(f.W,{value:e.profit_id,children:[e.type_profit,"%"]},e.profit_id))})})}},{title:"",dataIndex:"",key:"",render:(t,n,a)=>i.jsx("div",{className:"flex gap-2 items-center",children:i.jsx(c.ZP,{type:"primary",onClick:()=>{n.name?G(t=>t.map((t,n)=>n===e?{...t,products:t.products.filter((e,t)=>t!==a)}:t)):G(t=>t.map((t,i)=>i===e?{...t,products:t.products.map((e,t)=>t===n?.ikey?{...e,children:e.children?.filter((e,t)=>t!==a)}:e)}:t))},className:"bg-red-500",icon:i.jsx(w.ZkW,{})})})}],[J]=(0,j.Z)(),{postdata:X}=(0,a.Z)(),{datas:Y}=(0,_.v9)(e=>e.get_users),[ee,et]=(0,g.useState)(!1),en=async e=>{let n=await X(()=>l.Z.createPriceQuote({...e,opportunity:t??void 0,parts:D.map(e=>({title:e.title,products:e.products.map(e=>({product:e.product_id,price:e.price,quantity:e.quantity,vat:e.vat,profit:e.profit,list_detail:e.children}))}))}));(200===n||201===n)&&(et(!1),k((0,C.j)({})))},ei=async(e,t)=>{t&&G(n=>n.map((n,i)=>i===e?n.products.find(e=>e.product_id===t.product_id)?{...n,products:n.products.map(e=>e.product_id===t.product_id?{...e,quantity:e.quantity+1}:e)}:{...n,products:[...n.products,{...t,key:n.products.length,quantity:1}]}:n))},ea=async()=>{G(e=>[...e,{title:"",products:[],type_package:void 0}])},el=async()=>{J.submit()},er=async(e,t)=>{G(n=>n.map((n,i)=>i===e?{...n,title:t}:n))},es=async(e,t)=>{console.log(t),G(n=>n.map((n,i)=>i===e?{...n,type_package:t}:n))};return(0,i.jsxs)(i.Fragment,{children:[i.jsx(c.ZP,{hidden:!!e,className:"bg-blue-400 border-0 text-white font-semibold",icon:i.jsx(v.b0B,{}),ref:e,onClick:()=>{et(!0)},children:"Th\xeam b\xe1o gi\xe1"}),(0,i.jsxs)(o.Z,{title:"Tạo b\xe1o gi\xe1",open:ee,onCancel:()=>{et(!1)},footer:null,width:"100%",style:{maxWidth:"1000px"},children:[(0,i.jsxs)(p.Z,{defaultActiveKey:"1",style:{width:"100%"},type:"line",children:[i.jsx(y.Z,{tab:"Th\xf4ng tin b\xe1o gi\xe1",children:(0,i.jsxs)(h.Z,{layout:"vertical",form:J,onFinish:en,style:{display:"flex",flexWrap:"wrap",columnGap:"12px"},children:[!t&&i.jsx(h.Z.Item,{name:"project",label:"Dự \xe1n b\xe1o gi\xe1",rules:[{required:!0,message:"Vui l\xf2ng chọn dự \xe1n!"}],style:{minWidth:"240px",flex:"1 1 0%"},children:i.jsx(r.Z,{placeholder:"Chọn dự \xe1n",showSearch:!0,filterOption:(e,t)=>(Array.isArray(t?.children)?t.children.join(""):t?.children??"").toLowerCase().includes(e.toLowerCase()),dropdownRender:e=>(0,i.jsxs)(i.Fragment,{children:[e,i.jsx(u.Z,{style:{margin:"8px 0"}}),i.jsx(c.ZP,{type:"link",onClick:()=>{W.current?.click()},children:"+ Th\xeam t\xf9y chọn mới"})]}),children:b?.map(e=>i.jsx(f.W,{value:e.project_id,children:e.name},e.project_id))})}),i.jsx(h.Z.Item,{name:"reference_code",label:"M\xe3 tham chiếu",style:{minWidth:"240px",flex:"1 1 0%"},children:i.jsx(s.default,{})}),i.jsx(h.Z.Item,{name:"type_vat",label:"Loại thuế",style:{minWidth:"240px",flex:"1 1 0%"},children:(0,i.jsxs)(r.Z,{placeholder:"Select discount type",defaultValue:"none",onChange:e=>{M(e)},children:[i.jsx(f.W,{value:"none",children:"None"}),i.jsx(f.W,{value:"before",children:"Before"}),i.jsx(f.W,{value:"after",children:"After"})]})}),i.jsx(h.Z.Item,{name:"type_money",label:"Đơn vị tiền",style:{minWidth:"240px",flex:"1 1 0%"},children:(0,i.jsxs)(r.Z,{placeholder:"Select a currency type",children:[i.jsx(f.W,{value:"vnd",children:"VND"}),i.jsx(f.W,{value:"usd",children:"USD"})]})}),i.jsx(h.Z.Item,{name:"user_support",label:"Người phụ tr\xe1ch",style:{minWidth:"240px",flex:"1 1 0%"},children:i.jsx(r.Z,{placeholder:"Chọn nh\xe2n vi\xean",showSearch:!0,filterOption:(e,t)=>(Array.isArray(t?.children)?t.children.join(""):t?.children??"").toLowerCase().includes(e.toLowerCase()),children:Y?.map(e=>i.jsxs(f.W,{value:e.user_id,children:[e.first_name," ",e.last_name]},e.user_id))})}),i.jsx(h.Z.Item,{name:"status",label:"Trạng th\xe1i",rules:[{required:!0}],style:{minWidth:"240px",flex:"1 1 0%"},children:(0,i.jsxs)(r.Z,{placeholder:"Select status",children:[i.jsx(f.W,{value:"draff",children:"Draff"}),i.jsx(f.W,{value:"send",children:"Send"}),i.jsx(f.W,{value:"open",children:"Open"}),i.jsx(f.W,{value:"edit",children:"Edit"}),i.jsx(f.W,{value:"refuse",children:"Refuse"}),i.jsx(f.W,{value:"accept",children:"Accept"})]})}),i.jsx(h.Z.Item,{name:"date_start",label:"Ng\xe0y bắt đầu",style:{minWidth:"320px",flex:"1 1 0%"},children:i.jsx(m.default,{placeholder:"Chọn ng\xe0y bắt đầu",style:{width:"100%"}})}),i.jsx(h.Z.Item,{name:"date_expired",label:"Ng\xe0y kết th\xfac",rules:[{required:!0}],style:{minWidth:"320px",flex:"1 1 0%"},children:i.jsx(m.default,{placeholder:"Chọn ng\xe0y kết th\xfac",style:{width:"100%"}})})]})},1),(0,i.jsxs)(y.Z,{tab:"Th\xf4ng tin sản phẩm",children:[i.jsx(c.ZP,{type:"primary",className:"mb-4",onClick:ea,children:"Th\xeam th\xe0nh phần"}),D.length>0&&i.jsx("div",{className:"flex gap-2 flex-col p-2 bg-[#00A9AE] rounded-sm",children:D.map((e,t)=>i.jsx(i.Fragment,{children:(0,i.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,i.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[i.jsx(r.Z,{placeholder:"Chọn sản phẩm cần th\xeam",className:"min-w-56",showSearch:!0,onSelect:e=>{ei(t,L.find(t=>t.product_id===e))},filterOption:(e,t)=>(t?.children?.toString()??"").toLowerCase().includes(e.toLowerCase()),children:L?.map(e=>i.jsx(f.W,{value:e.product_id,children:e.name},e.product_id))}),(0,i.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[D.length>1&&i.jsx(s.default,{defaultValue:e.title,onChange:e=>{er(t,e.target.value)},placeholder:"Nhập t\xean ti\xeau đề"}),i.jsx(r.Z,{placeholder:"Chọn g\xf3i",className:"min-w-56",showSearch:!0,allowClear:!0,onSelect:e=>{es(t,e)},onClear:()=>{es(t,void 0)},filterOption:(e,t)=>(t?.children?.join("")??"").toLowerCase().includes(e.toLowerCase()),children:T?.map(e=>i.jsx(f.W,{value:e.package_id,children:e.name_package},e.package_id))})]})]}),i.jsx("div",{className:" w-full overflow-x-auto",children:i.jsx(x.Z,{columns:U(t),showHeader:0===t,footer:()=>{let e=D[t].products.reduce((e,t)=>{let n=t.price*t.quantity*((V.find(e=>e.profit_id===t.profit)?.type_profit??0)/100);return t.price*t.quantity+n+e},0);return(0,i.jsxs)("div",{className:"flex gap-2",children:[i.jsx("strong",{children:"Gi\xe1 trị:"})," ",e.toLocaleString("vi-VN")," VNĐ"]})},dataSource:e.products,pagination:{pageSize:10,showTotal:(e,t)=>`${t[0]}-${t[1]} of ${e} items`},scroll:{x:"max-content",y:200},showSorterTooltip:{target:"sorter-icon"}})})]})}))})]},2)]}),(0,i.jsxs)("div",{className:"flex flex-col items-end gap-2 p-2 w-full bg-slate-100 rounded-sm",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[i.jsx("p",{className:"w-80 flex justify-end",children:"Tổng:"}),(0,i.jsxs)("span",{className:"min-w-32 flex justify-end",children:[Math.round($).toLocaleString("vi-VN"),"đ"]})]}),i.jsx("div",{children:(0,i.jsxs)("div",{className:"flex sm:items-center justify-end items-end",children:[(0,i.jsxs)("div",{className:"sm:w-80 flex items-center justify-end gap-2 flex-wrap",children:["Chiết khấu"," ",i.jsx("div",{className:"sm:w-60",children:i.jsx(d.Z,{addonAfter:H,defaultValue:0,onChange:e=>{A(e??0)}})})]}),(0,i.jsxs)("span",{className:"min-w-32 flex justify-end",children:["-",R.toLocaleString("vi-VN"),"đ"]})]})}),(0,i.jsxs)("div",{className:"flex items-center",children:[i.jsx("p",{className:"w-80 flex justify-end",children:"Thuế:"}),(0,i.jsxs)("span",{className:"min-w-32 flex justify-end",children:[Math.round(E).toLocaleString("vi-VN"),"đ"]})]}),(0,i.jsxs)("div",{className:"flex items-center text-xl text-red-500",children:[i.jsx("p",{className:"w-80 flex justify-end",children:"Th\xe0nh tiền:"}),(0,i.jsxs)("span",{className:"min-w-32 flex justify-end",children:[Math.round($-R+E).toLocaleString("vi-VN"),"đ"]})]})]}),i.jsx("div",{className:"flex justify-end w-full mt-4",children:i.jsx(c.ZP,{type:"primary",onClick:el,children:"Tạo"})})]}),i.jsx(N.Z,{refBtnProject:W})]})}},96116:()=>{}};