"use strict";exports.id=8395,exports.ids=[8395],exports.modules={98395:(e,s,l)=>{l.d(s,{Z:()=>Y});var t=l(97247),n=l(28964),a=l(77951),i=l(61410),r=l(12927),d=l(1880),c=l(39884),h=l(95718),m=l(65794),x=l(35090),o=l(88506),u=l(77784),p=l(69160),j=l(23102),g=l(83473),y=l(99539),f=l(50678),v=l(2805),Z=l(41290),N=l(70944),_=l(48738),b=l(99801),C=l.n(b),w=l(77660),O=l(55757),I=l(99219),T=l(57989),k=l(89779),S=l(37013),W=l(51740),V=l(87597),P=l(28852);let Y=({ID:e,refBtnProject:s,type:l,setID:b})=>{let Y=(0,n.useRef)(),F=(0,n.useRef)(),[L,A]=(0,n.useState)(""),[M,B]=(0,n.useState)(""),[R,q]=(0,n.useState)([]),[D,E]=(0,n.useState)(!1),[G,z]=(0,n.useState)([]),{datas:H}=(0,j.v9)(e=>e.type_projects),{datas:$}=(0,j.v9)(e=>e.role_projects),{datas:J}=(0,j.v9)(e=>e.get_opportunities),{datas:K}=(0,j.v9)(e=>e.infos_customer),[U]=(0,p.Z)(),Q=(0,j.I0)(),{datas:X}=(0,j.v9)(e=>e.get_users),ee=(X??[])?.filter(e=>!R.some(s=>s.user===e.user_id)),{postdata:es}=(0,y.Z)(),el=async()=>{let s=await g.Z.getProject(e);200===s.statusCode&&(U.setFieldsValue(s.data),z([{uid:s.data.project_id,name:"logo.png",status:"done",url:s.data.picture_url}]),q(s?.data?.users??[]))},et=e=>{q(s=>s.filter(s=>s.user!==e))},en=async s=>{try{let t=(0,_.Z)(Object.entries({...s,start_date:s.start_date?s.start_date.toISOString():void 0,end_date:s.end_date?s.end_date.toISOString():void 0,picture_url:G.length>0?[G?.[0]?.originFileObj]:null,users:JSON.stringify(R)}).reduce((e,[s,l])=>(null!=l&&(e[s]=l),e),{})),n=await es(()=>g.Z.updateProject(e,t));(200===n||201===n)&&(Q((0,f.b)()),U.resetFields(),E(!1),"gantt"===l&&b&&(Q((0,N.C)()),b("")))}catch(e){console.error("Error updating project:",e)}},ea=(0,t.jsxs)("button",{style:{border:0,background:"none"},type:"button",children:[t.jsx(u.Z,{}),t.jsx("div",{style:{marginTop:8},children:"Upload"})]});return(0,t.jsxs)(t.Fragment,{children:[t.jsx(a.ZP,{hidden:!!s,type:"text",className:"text-xs text-yellow-500 font-semibold",onClick:()=>{E(!0),el()},ref:s,children:"Chỉnh sửa"}),t.jsx(i.Z,{title:"Cập nhật dự \xe1n",open:D,onCancel:()=>{E(!1),b&&b("")},footer:null,width:"100%",style:{maxWidth:"800px"},children:(0,t.jsxs)(r.Z,{layout:"vertical",form:U,onFinish:en,style:{display:"flex",flexWrap:"wrap",gap:"12px"},children:[t.jsx(r.Z.Item,{name:"name",label:"T\xean dự \xe1n",style:{minWidth:"320px",flex:"1 1 0%"},rules:[{required:!0,message:"Vui l\xf2ng nhập t\xean dự \xe1n"}],children:t.jsx(d.default,{placeholder:"T\xean dự \xe1n"})}),t.jsx(r.Z.Item,{name:"customer",label:"Kh\xe1ch h\xe0ng",style:{minWidth:"320px",flex:"1 1 0%"},rules:[{required:!0,message:"Vui l\xf2ng nhập t\xean kh\xe1ch h\xe0ng"}],children:t.jsx(c.Z,{placeholder:"Chọn kh\xe1ch h\xe0ng",showSearch:!0,filterOption:(e,s)=>(Array.isArray(s?.children)?s.children.join(""):s?.children??"").toLowerCase().includes(e.toLowerCase()),dropdownRender:e=>(0,t.jsxs)(t.Fragment,{children:[e,t.jsx(h.Z,{style:{margin:"8px 0"}}),t.jsx(a.ZP,{type:"link",onClick:()=>{F.current?.click()},children:"+ Th\xeam t\xf9y chọn mới"})]}),children:K?.map(e=>t.jsx(c.Z.Option,{value:e.info_id,children:e.name_company},e.info_id))})}),t.jsx(r.Z.Item,{name:"opportunity",label:"Cơ hội",style:{minWidth:"320px",flex:"1 1 0%"},rules:[],children:t.jsx(c.Z,{placeholder:"Chọn cơ hội",showSearch:!0,filterOption:(e,s)=>(Array.isArray(s?.children)?s.children.join(""):s?.children??"").toLowerCase().includes(e.toLowerCase()),children:J?.map(e=>t.jsx(c.Z.Option,{value:e.opportunity_id,children:e.company_name},e.opportunity_id))})}),t.jsx(r.Z.Item,{name:"type",label:"Loại dự \xe1n",style:{minWidth:"320px",flex:"1 1 0%"},rules:[{required:!0,message:"Vui l\xf2ng chọn loại dự \xe1n"}],children:t.jsx(c.Z,{placeholder:"Chọn loại",showSearch:!0,filterOption:(e,s)=>(Array.isArray(s?.children)?s.children.join(""):s?.children??"").toLowerCase().includes(e.toLowerCase()),dropdownRender:e=>(0,t.jsxs)(t.Fragment,{children:[e,t.jsx(h.Z,{style:{margin:"8px 0"}}),t.jsx(a.ZP,{type:"link",onClick:()=>{Y.current?.click()},children:"+ Th\xeam t\xf9y chọn mới"})]}),children:H?.map(e=>t.jsx(c.Z.Option,{value:e.type_id,children:e.name_type},e.type_id))})}),t.jsx(r.Z.Item,{name:"status",label:"Trạng th\xe1i",rules:[{required:!0,message:"Vui l\xf2ng chọn trạng th\xe1i"}],style:{minWidth:"220px",flex:"1 1 0%"},children:(0,t.jsxs)(c.Z,{placeholder:"Chọn trạng th\xe1i",children:[t.jsx(c.Z.Option,{value:"waiting",children:"Đang chờ"}),t.jsx(c.Z.Option,{value:"start",children:"Bắt đầu"}),t.jsx(c.Z.Option,{value:"pause",children:"Tạm dừng"}),t.jsx(c.Z.Option,{value:"cancel",children:"Hủy"}),t.jsx(c.Z.Option,{value:"completed",children:"Ho\xe0n th\xe0nh"})]})}),t.jsx(r.Z.Item,{name:"price",label:"Gi\xe1 trị (vnđ)",style:{minWidth:"320px",flex:"1 1 0%"},children:t.jsx(m.Z,{placeholder:"Gi\xe1 trị",className:"w-full",formatter:e=>`${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e?.replace(/\$\s?|(,*)/g,"")})}),t.jsx(r.Z.Item,{name:"time_job",label:"Thời gian (giờ)",style:{minWidth:"220px",flex:"1 1 0%"},children:t.jsx(m.Z,{placeholder:"Thời gian c\xf4ng việc",className:"w-full"})}),t.jsx(r.Z.Item,{name:"start_date",label:"Ng\xe0y bắt đầu",initialValue:"",className:" mb-0",style:{minWidth:"320px",flex:"1 1 0%"},getValueFromEvent:e=>e?.format("YYYY-MM-DD"),getValueProps:e=>({value:e?C()(e):""}),children:t.jsx(x.default,{placeholder:"Chọn ng\xe0y bắt đầu",style:{width:"100%"}})}),t.jsx(r.Z.Item,{name:"end_date",label:"Ng\xe0y kết th\xfac",initialValue:"",className:" mb-0",style:{minWidth:"320px",flex:"1 1 0%"},getValueFromEvent:e=>e?.format("YYYY-MM-DD"),getValueProps:e=>({value:e?C()(e):""}),children:t.jsx(x.default,{placeholder:"Chọn ng\xe0y kết th\xfac",style:{width:"100%"}})}),t.jsx(r.Z.Item,{name:"user_support",label:"Nh\xe2n vi\xean hỗ trợ",style:{minWidth:"220px",flex:"1 1 0%"},children:t.jsx(c.Z,{placeholder:"Chọn nh\xe2n vi\xean",children:X?.map(e=>t.jsxs(c.Z.Option,{value:e.user_id,children:[e.first_name," ",e.last_name]},e.user_id))})}),t.jsx(r.Z.Item,{name:"description",label:"M\xf4 tả",style:{width:"100%"},children:t.jsx(d.default.TextArea,{placeholder:"M\xf4 tả dự \xe1n",autoSize:{minRows:3}})}),t.jsx(r.Z.Item,{name:"picture_url",label:"Ảnh đại diện",className:"!m-0",style:{minWidth:"320px",flex:"1 1 0%"},children:t.jsx(o.default,{maxCount:1,action:"",listType:"picture-card",fileList:G,onPreview:e=>{Q((0,w.BZ)(e.url))},onChange:({file:e})=>{"removed"===e.status?z([]):z([e])},children:G.length>0?null:ea})}),t.jsx(r.Z.Item,{className:"!m-0",style:{minWidth:"100%",flex:"1 1 0%"},children:(0,t.jsxs)(O.Zb,{className:"w-full",children:[t.jsx(O.Ol,{children:(0,t.jsxs)(O.ll,{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:t.jsx("span",{className:"text-green-600 font-semibold text-sm",children:"2"})}),"Ph\xe2n c\xf4ng dự \xe1n"]})}),(0,t.jsxs)(O.aY,{className:"space-y-4",children:[t.jsx(O.Zb,{className:"border-dashed border-2 border-gray-200",children:t.jsx(O.aY,{className:"p-4",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[t.jsx(I.Z,{className:"w-4 h-4"}),"Th\xeam th\xe0nh vi\xean"]}),0===ee.length?(0,t.jsxs)("div",{className:"text-center py-6 text-gray-500",children:[t.jsx(T.Z,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),t.jsx("p",{children:"Tất cả người d\xf9ng đ\xe3 được ph\xe2n c\xf4ng"})]}):(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx(W._,{children:"Chọn nh\xe2n vi\xean"}),t.jsx(c.Z,{placeholder:"Chọn nh\xe2n vi\xean",className:"h-14",value:L,onChange:A,children:ee?.map(e=>t.jsx(c.Z.Option,{value:e.user_id,children:t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"font-medium",children:e.first_name+" "+e.last_name}),t.jsx("span",{className:"text-xs text-gray-500",children:e.email})]})},e.user_id))})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx(W._,{children:"Chọn vai tr\xf2"}),t.jsx(c.Z,{placeholder:"Chọn vai tr\xf2",className:"h-14",value:M,onChange:B,children:$?.map(e=>t.jsx(c.Z.Option,{value:e.role_id??"",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(V.C,{variant:"outline",className:"text-xs",children:e.name_tag}),t.jsx("span",{children:e.name})]})},e.role_id))})]}),t.jsx("div",{className:"flex items-end",children:(0,t.jsxs)(P.Z2,{onClick:()=>{if(!L||!M){alert("Vui l\xf2ng chọn người d\xf9ng v\xe0 vai tr\xf2");return}if(L&&M){let e={user:L,role:M};q(s=>[...s,e]),A(""),B("")}},disabled:!L||!M,className:"w-full",children:[t.jsx(I.Z,{className:"w-4 h-4 mr-2"}),"Th\xeam"]})})]})]})})}),R.length>0&&(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[t.jsx(k.Z,{className:"w-4 h-4"}),"Th\xe0nh vi\xean đ\xe3 ph\xe2n c\xf4ng (",R.length,")"]}),t.jsx("div",{className:"space-y-2",children:R.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg border",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:t.jsx(T.Z,{className:"w-4 h-4 text-blue-600"})}),(0,t.jsxs)("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:X?.find(s=>s.user_id===e.user)?.first_name+" "+X?.find(s=>s.user_id===e.user)?.last_name}),t.jsx("div",{className:"text-sm text-gray-500",children:X?.find(s=>s.user_id===e.user)?.email})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx(V.C,{variant:"secondary",className:"bg-blue-100 text-blue-800",children:$?.find(s=>s.role_id===e.role)?.name_tag}),t.jsx("span",{className:"text-sm text-gray-600",children:$?.find(s=>s.role_id===e.role)?.name}),t.jsx(P.Z2,{type:"button",variant:"ghost",size:"sm",onClick:()=>et(e.user),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:t.jsx(S.Z,{className:"w-4 h-4"})})]})]},e.user))})]})]})]})}),t.jsx(r.Z.Item,{style:{width:"100%",display:"flex",justifyContent:"end"},children:t.jsx(a.ZP,{type:"primary",htmlType:"submit",children:"Cập nhật"})})]})}),t.jsx(v.Z,{refBtnGroup:Y}),t.jsx(Z.Z,{refBtnCustomer:F})]})}}};