"use strict";exports.id=9731,exports.ids=[9731],exports.modules={39731:(e,t,l)=>{l.d(t,{Z:()=>eA});var a=l(97247),s=l(28964),n=l(77951),r=l(39884),i=l(61410),c=l(77709),d=l(96538),o=l(23102),h=l(41290),x=l(57233),m=l(99539),p=l(84169),u=l(68967),g=l(82140),f=l(12927),j=l(95718),y=l(1880),v=l(65794),b=l(35090),w=l(69160),N=l(41201),C=l(75142),_=l(75569),Z=l(99801),k=l.n(Z);function S({ID:e}){let t=(0,s.useRef)(),l=(0,s.useRef)(),c=(0,s.useRef)(),{datas:d}=(0,o.v9)(e=>e.get_type_contract),{datas:Z}=(0,o.v9)(e=>e.infos_customer),{datas:S}=(0,o.v9)(e=>e.get_projects),[T]=(0,w.Z)(),{postdata:D}=(0,m.Z)(),F=(0,o.I0)(),[I,R]=(0,s.useState)(!1),A=async()=>{let t=await u.Z.getContract(e);200===t.statusCode&&(console.log(t.data),T.setFieldsValue(t.data))},P=async t=>{let l=await D(()=>u.Z.updateContract(e,t));(200===l||201===l)&&(F((0,p.Wq)(null)),R(!1))},B=async()=>{T.submit()};return(0,a.jsxs)(a.Fragment,{children:[a.jsx(n.ZP,{className:"  text-xs text-yellow-500 font-semibold",type:"text",onClick:()=>{R(!0),A()},children:"Chỉnh sửa"}),(0,a.jsxs)(i.Z,{title:"Cập nhật hợp đồng",open:I,onCancel:()=>{R(!1)},footer:null,width:"100%",style:{maxWidth:"800px"},children:[a.jsx(g.Z,{defaultActiveKey:"1",style:{width:"100%"},type:"line",children:a.jsx(C.Z,{tab:"Th\xf4ng tin hợp đồng",children:(0,a.jsxs)(f.Z,{layout:"vertical",form:T,onFinish:P,style:{display:"flex",flexWrap:"wrap",columnGap:"12px"},children:[a.jsx(f.Z.Item,{name:"customer",label:"Kh\xe1ch h\xe0ng",rules:[{required:!0,message:"Vui l\xf2ng chọn kh\xe1ch h\xe0ng!"}],style:{width:"100%",flex:"1 1 0%"},children:a.jsx(r.Z,{placeholder:"Chọn kh\xe1ch h\xe0ng",showSearch:!0,filterOption:(e,t)=>(Array.isArray(t?.children)?t.children.join(""):t?.children??"").toLowerCase().includes(e.toLowerCase()),dropdownRender:e=>(0,a.jsxs)(a.Fragment,{children:[e,a.jsx(j.Z,{style:{margin:"8px 0"}}),a.jsx(n.ZP,{type:"link",onClick:()=>{t.current?.click()},children:"+ Th\xeam t\xf9y chọn mới"})]}),children:Z?.map(e=>a.jsx(N.W,{value:e.info_id,children:e.name_company},e.info_id))})}),a.jsx(f.Z.Item,{name:"project",label:"Dự \xe1n",style:{width:"100%",flex:"1 1 0%"},children:a.jsx(r.Z,{placeholder:"Chọn dự \xe1n",showSearch:!0,filterOption:(e,t)=>(Array.isArray(t?.children)?t.children.join(""):t?.children??"").toLowerCase().includes(e.toLowerCase()),dropdownRender:e=>(0,a.jsxs)(a.Fragment,{children:[e,a.jsx(j.Z,{style:{margin:"8px 0"}}),a.jsx(n.ZP,{type:"link",onClick:()=>{l.current?.click()},children:"+ Th\xeam t\xf9y chọn mới"})]}),children:S?.map(e=>a.jsx(N.W,{value:e.project_id,children:e.name},e.project_id))})}),a.jsx(f.Z.Item,{name:"name_contract",label:"T\xean hợp đồng",rules:[{required:!0,type:"string",message:"Vui l\xf2ng nhập t\xean hợp đồng"}],style:{minWidth:"100%",flex:"1 1 0%"},children:a.jsx(y.default,{})}),a.jsx(f.Z.Item,{name:"code_contract",label:"M\xe3 hợp đồng",rules:[{required:!0,type:"string",message:"Vui l\xf2ng nhập m\xe3 hợp đồng"}],style:{minWidth:"100%",flex:"1 1 0%"},children:a.jsx(y.default,{})}),a.jsx(f.Z.Item,{name:"price",label:"Gi\xe1 trị hợp đồng(vnđ)",style:{minWidth:"240px",flex:"1 1 0%"},children:a.jsx(v.Z,{placeholder:"Price",className:"w-full",formatter:e=>`${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e?.replace(/\$\s?|(,*)/g,"")})}),a.jsx(f.Z.Item,{name:"type_contract",label:"Loại hợp đồng",style:{minWidth:"240px",flex:"1 1 0%"},children:a.jsx(r.Z,{placeholder:"Chọn loại",showSearch:!0,filterOption:(e,t)=>(Array.isArray(t?.children)?t.children.join(""):t?.children??"").toLowerCase().includes(e.toLowerCase()),dropdownRender:e=>(0,a.jsxs)(a.Fragment,{children:[e,a.jsx(j.Z,{style:{margin:"8px 0"}}),a.jsx(n.ZP,{type:"link",onClick:()=>{c.current?.click()},children:"+ Th\xeam t\xf9y chọn mới"})]}),children:d?.map(e=>a.jsx(N.W,{value:e.type_id,children:e.name_type},e.type_id))})}),a.jsx(f.Z.Item,{name:"type",label:"Loại thanh to\xe1n",rules:[{required:!0}],style:{minWidth:"240px",flex:"1 1 0%"},children:(0,a.jsxs)(r.Z,{placeholder:"Select status",children:[a.jsx(N.W,{value:"default",children:"Cố định"}),a.jsx(N.W,{value:"time",children:"Chu k\xec"})]})}),a.jsx(f.Z.Item,{name:"date_start",label:"Ng\xe0y bắt đầu",initialValue:"",className:" mb-0",style:{minWidth:"320px",flex:"1 1 0%"},getValueFromEvent:e=>e?.format("YYYY-MM-DD"),getValueProps:e=>({value:e?k()(e):""}),children:a.jsx(b.default,{placeholder:"Chọn ng\xe0y bắt đầu",style:{width:"100%"}})}),a.jsx(f.Z.Item,{name:"date_expired",label:"Ng\xe0y kết th\xfac",rules:[{required:!0}],initialValue:"",className:" mb-0",style:{minWidth:"320px",flex:"1 1 0%"},getValueFromEvent:e=>e?.format("YYYY-MM-DD"),getValueProps:e=>({value:e?k()(e):""}),children:a.jsx(b.default,{placeholder:"Chọn ng\xe0y kết th\xfac",style:{width:"100%"}})}),a.jsx(f.Z.Item,{name:"description",label:"M\xf4 tả",style:{width:"100%"},children:a.jsx(y.default.TextArea,{placeholder:"Description",autoSize:{minRows:3}})})]})},1)}),a.jsx("div",{className:"flex justify-end w-full mt-4",children:a.jsx(n.ZP,{type:"primary",onClick:B,children:"Chỉnh sửa"})})]}),a.jsx(h.Z,{refBtnCustomer:t}),a.jsx(x.Z,{refBtnProject:l}),a.jsx(_.Z,{refBtnType:c})]})}var T=l(16523),D=l(34178),F=l(77784),I=l(67561),R=l(53130),A=l(26782),P=l(75003),B=l(74482);let L=e=>{let t=e.toLowerCase();return t.includes("/video/")?"Video":t.includes("/image/")?"Image":t.includes("/raw/")?"Raw":"Unknown"};var H=l(48738);let V=(0,l(2761).default)(async()=>{},{loadableGenerated:{modules:["components\\Contract\\Tool\\Modal\\ModalDocument\\ModalDocument.tsx -> ./DocsView/DocsView"]},ssr:!1});function W({refBtnActivity:e,ID:t}){let{postdata:l}=(0,m.Z)(),[r,c]=(0,s.useState)(""),[d,o]=(0,s.useState)([]),[h,x]=(0,s.useState)([]),[p,g]=(0,s.useState)([]),[f,j]=(0,s.useState)(!1),y=async()=>{let e=await u.Z.getDocumentContractById(t);200===e.statusCode&&(x(e.data.filter(e=>"Image"===L(e.url)).map(e=>({uid:e.document_id,name:e.document_id,status:"done",url:e.url}))),g(e.data.filter(e=>"Raw"===L(e.url)).map(e=>({uid:e.document_id,name:e.document_id+"."+e?.type,status:"done",url:e.url}))))},v=async e=>{if(e.url)try{let t=document.createElement("a");t.href=e.url,t.click()}catch(e){console.error("Lỗi khi tải file:",e)}else console.error("URL của file kh\xf4ng tồn tại")},b=async({file:e})=>{if(e?.url&&e?.status==="removed")200===await l(()=>u.Z.deleteDocumentContract(e.uid))&&y();else{let a={contract:t,url:[e.originFileObj]};if(a){let e=(0,H.Z)(a);201===await l(()=>u.Z.createDocumentContract(e))&&y()}}},w=async e=>{if(e.url)try{let t=e.name.split(".").pop(),l="";"pdf"===t?l="application/pdf":"docx"===t?l="application/vnd.openxmlformats-officedocument.wordprocessingml.document":"xlsx"===t?l="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"png"===t||"jpeg"===t||"jpg"===t?l="image/"+t:"mp4"===t&&(l="video/mp4"),o([{uri:e.url,fileType:l}])}catch(e){console.error("Lỗi khi tải file:",e)}else console.error("URL của file kh\xf4ng tồn tại")},N=(0,a.jsxs)("button",{style:{border:0,background:"none"},type:"button",children:[a.jsx(F.Z,{}),a.jsx("div",{style:{marginTop:8},children:"Upload"})]});return(0,a.jsxs)(a.Fragment,{children:[a.jsx(n.ZP,{hidden:!!e,type:"text",className:"text-xs text-blue-600",onClick:()=>{j(!0),y()},ref:e,children:"T\xe0i liệu"}),(0,a.jsxs)(i.Z,{title:"T\xe0i liệu",open:f,className:"flex flex-col gap-4",onCancel:()=>{j(!1)},footer:null,width:"100%",style:{maxWidth:"800px"},children:[(0,a.jsxs)("div",{className:"mb-2  pb-2",children:[a.jsx("div",{className:"flex items-center text-xs font-medium text-[#EB8823] hover:opacity-85 cursor-pointer mb-2",children:a.jsx("p",{className:"pointer-events-none",children:"Ảnh t\xe0i liệu"})}),a.jsx("div",{className:"!m-0 max-h-32 overflow-y-auto",style:{minWidth:"320px",flex:"1 1 0%"},children:a.jsx(B.Z,{action:"",className:"!m-0",listType:"picture-card",fileList:h.reverse(),onPreview:e=>{c(e?.url??"")},onChange:e=>{b(e)},multiple:!0,children:N})})]}),(0,a.jsxs)("div",{children:[a.jsx("div",{className:"flex items-center text-xs font-medium text-[#EB8823] hover:opacity-85 cursor-pointer mb-2",children:a.jsx("p",{className:"pointer-events-none",children:"File t\xe0i liệu"})}),a.jsx("div",{className:"!m-0 max-w-full overflow-x-auto",style:{minWidth:"320px",flex:"1 1 0%"},children:a.jsx(B.Z,{action:"",listType:"text",fileList:p,onPreview:e=>{v(e)},itemRender:(e,t)=>(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"flex-1 sm:w-96 w-12",children:e}),a.jsx(n.ZP,{type:"link",icon:a.jsx(I.Z,{}),onClick:()=>v(t),className:"flex-none w-24 text-center",children:"Download"}),a.jsx(n.ZP,{type:"link",icon:a.jsx(R.Z,{}),onClick:()=>{w(t)},className:"flex-none w-24 text-center",children:"Preview"})]}),onChange:e=>{b(e)},multiple:!0,children:a.jsx(n.ZP,{icon:a.jsx(A.Z,{}),children:"Select File"})})})]})]}),a.jsx(P.Z,{hidden:!0,preview:{visible:""!==r,onVisibleChange:()=>c("")},alt:"",src:r}),a.jsx(i.Z,{className:"!h-fit !w-fit",open:d.length>0,footer:null,onCancel:()=>{o([])},children:a.jsx("div",{className:"!w-[90vw] !h-[80vh]",children:a.jsx(V,{docs:d})})})]})}var E=l(67552);function z(){let e=(0,o.I0)(),t=(0,E.Z)(["admin-top","contract","contract-edit"]),{customerID:l}=(0,D.useParams)(),[h,x]=(0,s.useState)(25),{datas:g}=(0,o.v9)(e=>e.get_contracts),[f,j]=(0,s.useState)([]),y=[{title:"M\xe3 hợp đồng",className:"text-xs",dataIndex:"code_contract",render:(e,l)=>(0,a.jsxs)("div",{className:"flex flex-col gap-1 ",children:[a.jsx("strong",{}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx(n.ZP,{type:"text",ghost:!0,className:"text-xs text-blue-600",children:"Xem"}),t&&(0,a.jsxs)(a.Fragment,{children:[a.jsx(S,{ID:l.contract_id}),a.jsx(W,{ID:l.contract_id})]})]})]}),sorter:(e,t)=>e.contract_id.localeCompare(t.contract_id)},{title:"T\xean hợp đồng",dataIndex:"name_contract",className:"text-xs",render:e=>e||"N/A",sorter:(e,t)=>(e.name_contract||"").localeCompare(t.name_contract||"")},{title:"Kh\xe1ch h\xe0ng",dataIndex:["customer","name_company"],className:"text-xs",render:e=>e||"N/A",sorter:(e,t)=>(e.customer?.name_company||"").localeCompare(t.customer?.name_company||"")},{title:"Loại hợp đồng",dataIndex:["type_contract","name_type"],className:"text-xs",render:e=>e||"N/A",sorter:(e,t)=>(e.type_contract?.name_type||"").localeCompare(t.type_contract?.name_type||"")},{title:"Gi\xe1 trị hợp đồng",dataIndex:"price",className:"text-xs",render:e=>e?`${e.toLocaleString("vi-VN")}đ`:"N/A",sorter:(e,t)=>(e.price||0)-(t.price||0)},{title:"Ng\xe0y bắt đầu",dataIndex:"date_start",className:"text-xs",render:e=>e?new Date(e).toLocaleDateString("vi-VN"):"N/A",sorter:(e,t)=>new Date(e.date_start||0).getTime()-new Date(t.date_start||0).getTime()},{title:"Ng\xe0y kết th\xfac",dataIndex:"date_expired",className:"text-xs",render:e=>e?new Date(e).toLocaleDateString("vi-VN"):"N/A",sorter:(e,t)=>new Date(e.date_expired||0).getTime()-new Date(t.date_expired||0).getTime()},{title:"Trạng th\xe1i",dataIndex:"status",className:"text-xs",render:e=>a.jsx("span",{style:{color:"active"===e?"green":"hide"===e?"gray":"red"},children:"delete"===e?"X\xf3a":"active"===e?"Hoạt động":"Ẩn"}),sorter:(e,t)=>(e.status||"").localeCompare(t.status||"")}],v=e=>{j(g?.filter(t=>String(t.created_at+" "+t.date_expired+" "+t.date_start+" "+t.project?.name+" "+t.name_contract+" "+t.contract_id+" "+t.customer?.name_company+" "+t.status).toLowerCase().includes(e.toLowerCase())))},{postdata:b}=(0,m.Z)(),[w,N]=(0,s.useState)(!1),[C,_]=(0,s.useState)([]),Z=async()=>{200===await b(()=>u.Z.deleteContract(C))&&(e((0,p.Wq)(null)),_([]),N(!1))};return(0,D.useSearchParams)(),(0,a.jsxs)("div",{className:"",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2 flex-wrap gap-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[a.jsx(r.Z,{defaultValue:h,style:{width:83},onChange:e=>x(e),options:[{value:10,label:10},{value:25,label:25},{value:50,label:50},{value:100,label:100},{value:500,label:500},{value:1e3,label:1e3},{value:1e8,label:"Tất cả"}]}),a.jsx(n.ZP,{hidden:!(C.length>0),children:"Xuất ra"}),a.jsx(n.ZP,{onClick:()=>{N(!0)},danger:!0,hidden:!(C.length>0),className:"text-xl",icon:a.jsx(T.FH3,{})}),a.jsx(i.Z,{open:w,title:"X\xf3a dữ liệu",onOk:Z,onCancel:()=>{N(!1)},children:"Bạn c\xf3 chắc chắn muốn x\xf3a kh\xf4ng ?"})]}),a.jsx("div",{className:"flex items-center",children:a.jsx(d.Z,{onChange:e=>{v(e.target.value)},placeholder:"T\xecm kiếm",style:{width:200}})})]}),a.jsx("div",{className:"w-full overflow-auto",children:a.jsx("div",{className:"min-w-fit",children:a.jsx(c.Z,{columns:y,rowSelection:{onChange:(e,t)=>{_(t.map(e=>e.contract_id))}},dataSource:f,scroll:{x:"max-content"},pagination:{pageSize:h,showTotal:(e,t)=>`${t[0]}-${t[1]} of ${e} items`},showSorterTooltip:{target:"sorter-icon"}})})})]})}var M=l(41479),G=l(53803),X=l(78575),$=l(28852),Y=l(55757),q=l(40677);let K=s.forwardRef(({className:e,...t},l)=>a.jsx("div",{className:"relative w-full overflow-auto",children:a.jsx("table",{ref:l,className:(0,q.cn)("w-full caption-bottom text-sm",e),...t})}));K.displayName="Table";let O=s.forwardRef(({className:e,...t},l)=>a.jsx("thead",{ref:l,className:(0,q.cn)("[&_tr]:border-b",e),...t}));O.displayName="TableHeader";let U=s.forwardRef(({className:e,...t},l)=>a.jsx("tbody",{ref:l,className:(0,q.cn)("[&_tr:last-child]:border-0",e),...t}));U.displayName="TableBody",s.forwardRef(({className:e,...t},l)=>a.jsx("tfoot",{ref:l,className:(0,q.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t})).displayName="TableFooter";let J=s.forwardRef(({className:e,...t},l)=>a.jsx("tr",{ref:l,className:(0,q.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...t}));J.displayName="TableRow";let Q=s.forwardRef(({className:e,...t},l)=>a.jsx("th",{ref:l,className:(0,q.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));Q.displayName="TableHead";let ee=s.forwardRef(({className:e,...t},l)=>a.jsx("td",{ref:l,className:(0,q.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t}));ee.displayName="TableCell",s.forwardRef(({className:e,...t},l)=>a.jsx("caption",{ref:l,className:(0,q.cn)("mt-4 text-sm text-muted-foreground",e),...t})).displayName="TableCaption";var et=l(87597),el=l(7424),ea=l(999),es=l(69964),en=l(50820),er=l(33841),ei=l(48799),ec=l(20290),ed=l(8749),eo=l(74747);let eh=(0,l(87972).j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),ex=s.forwardRef(({className:e,variant:t,...l},s)=>a.jsx("div",{ref:s,role:"alert",className:(0,q.cn)(eh({variant:t}),e),...l}));ex.displayName="Alert";let em=s.forwardRef(({className:e,...t},l)=>a.jsx("h5",{ref:l,className:(0,q.cn)("mb-1 font-medium leading-none tracking-tight",e),...t}));em.displayName="AlertTitle";let ep=s.forwardRef(({className:e,...t},l)=>a.jsx("div",{ref:l,className:(0,q.cn)("text-sm [&_p]:leading-relaxed",e),...t}));ep.displayName="AlertDescription";var eu=l(85426),eg=l(51740),ef=l(11019);let ej=s.forwardRef(({className:e,...t},l)=>a.jsx(ef.fC,{ref:l,className:(0,q.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...t,children:a.jsx(ef.z$,{className:(0,q.cn)("flex items-center justify-center text-current"),children:a.jsx(ei.Z,{className:"h-4 w-4"})})}));ej.displayName=ef.fC.displayName;var ey=l(13808),ev=l(27035),eb=l.n(ev),ew=l(8353);async function eN(e,t){try{if(!e||0===e.length){alert("Kh\xf4ng c\xf3 dữ liệu để xuất!");return}let l=new(eb()).Workbook,a=l.addWorksheet("DanhSachHopDong");a.addRow([]),a.mergeCells("B2:J2"),a.getCell("B2").value="DANH S\xc1CH HỢP ĐỒNG",a.getCell("B2").font={size:22,bold:!0},a.getCell("B2").alignment={horizontal:"center",vertical:"middle"},a.addRow([]),a.mergeCells("B3:J3"),a.getCell("B3").value="(*Lưu \xfd: th\xeam đ\xfang gi\xe1 trị theo cột đ\xe3 được quy định sẵn trước khi d\xf9ng import)",a.getCell("B3").font={size:14},a.getCell("B3").alignment={horizontal:"center",vertical:"middle"},a.columns=[{key:"empty",width:5},{key:"name_contract",width:30},{key:"code_contract",width:20},{key:"project",width:20},{key:"customer",width:25},{key:"price",width:15},{key:"type_contract",width:20},{key:"date_start",width:18},{key:"date_expired",width:18},{key:"description",width:35}],a.addRow(["","T\xcaN HỢP ĐỒNG","M\xc3 HỢP ĐỒNG","DỰ \xc1N","KH\xc1CH H\xc0NG","GI\xc1 TRỊ","LOẠI HỢP ĐỒNG","NG\xc0Y BẮT ĐẦU","NG\xc0Y KẾT TH\xdaC","M\xd4 TẢ"]);let s=a.getRow(4);s.font={bold:!0,color:{argb:"FFFFFF"},size:12},s.alignment={horizontal:"center",vertical:"middle"};for(let e=2;e<=10;e++){let t=s.getCell(e);t.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1BA49D"}},t.border={top:{style:"thin"},left:{style:"thin"},right:{style:"thin"},bottom:{style:"thin"}}}let n=5;e.forEach(e=>{a.addRow({empty:"",name_contract:e.name_contract,code_contract:e.code_contract,project:e.project||"",customer:e.customer,price:e.price||0,type_contract:e.type_contract||"",date_start:e.date_start||"",date_expired:e.date_expired||"",description:e.description||""});let t=a.getRow(n);t.font={size:12};for(let e=2;e<=10;e++)t.getCell(e).border={top:{style:"thin"},left:{style:"thin"},right:{style:"thin"},bottom:{style:"thin"}};n++});let r=await l.xlsx.writeBuffer();(0,ew.saveAs)(new Blob([r],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),`${t||`Danh_Sach_Hop_Dong_${new Date().toISOString().slice(0,10)}.xlsx`}`)}catch(e){console.error(e)}}var eC=l(53211);function e_(){let e=(0,o.I0)(),[t,l]=(0,s.useState)([]),{datas:n}=(0,o.v9)(e=>e.infos_customer),{datas:r}=(0,o.v9)(e=>e.get_projects),[c,d]=(0,s.useState)(null),[h,x]=(0,s.useState)(""),[m,g]=(0,s.useState)(""),[f,j]=(0,s.useState)(!1),[y,v]=(0,s.useState)(!1),[b,w]=(0,s.useState)("date_expired"),[N,C]=(0,s.useState)(!1),[_,Z]=(0,s.useState)(!1),[k,S]=(0,s.useState)(!1),T=async()=>{await eN([{name_contract:"C\xf4ng ty ABC",code_contract:"HĐ-01",project:"Dự \xe1n ABC",customer:"Kh\xe1ch h\xe0ng ABC",price:0,type_contract:"Hợp đồng thương mại",date_start:"8/2/2025",date_expired:"9/2/2025",description:"M\xf4 tả ABC"}],"Template mẫu hợp đồng.xlsx")},D=e=>{let t="string"==typeof e?Number.parseFloat(e):e;return new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(t||0)},F=async()=>{let e=h?new Date(h).getTime().toString():void 0,t=m?new Date(m).getTime().toString():void 0,l=await u.Z.getContractsFilterFull({time_start:e,time_end:t});if(l?.statusCode===200){let e=l?.data;if(0===e.length){d({type:"error",message:"Khong co hop dong nao trong khoang thoi gian da chon!"});return}d({type:"success",message:`Xuat thanh cong ${e.length} hop dong theo bo loc thoi gian!`}),eN(e.map(e=>({...e,project:r.find(t=>t.project_id===e.project)?.name,customer:n.find(t=>t.info_id===e.customer)?.name_company,type_contract:e?.type_contract?.name_type})),`Danh s\xe1ch ${e.length} hợp đồng`)}},I=e=>{l(t=>t.map((t,l)=>l===e?{...t,selected:!t.selected}:t))},R=async()=>{if(0===t.filter(e=>e.selected&&!e.applied).length){d({type:"error",message:"Vui long chon it nhat mot hop dong de apply!"});return}let a=await u.Z.importContracts(t);a?.statusCode===200&&(v(!1),C(!0),S(!1),l([]),e((0,p.Wq)(null)))},A=t.filter(e=>e.selected&&!e.applied).length,P=t.filter(e=>!e.applied).length,B=t.filter(e=>e.applied).length;return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(Y.Zb,{children:[(0,a.jsxs)(Y.Ol,{children:[(0,a.jsxs)(Y.ll,{className:"flex items-center gap-2",children:[a.jsx(el.Z,{className:"h-5 w-5 text-emerald-600"}),"Import / Export Excel"]}),a.jsx(Y.SZ,{children:"Tải template mẫu, import danh s\xe1ch hợp đồng hoặc xuất dữ liệu ra file Excel"})]}),a.jsx(Y.aY,{children:(0,a.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,a.jsxs)($.zx,{onClick:T,variant:"outline",className:"gap-2 bg-transparent",children:[a.jsx(ea.Z,{className:"h-4 w-4"}),"Tải template mẫu"]}),(0,a.jsxs)("div",{className:"relative",children:[a.jsx("input",{type:"file",accept:".xlsx,.xls",onChange:e=>{let t=e.target.files?.[0];if(!t)return;let a=new FileReader;a.onload=e=>{try{let t=e.target?.result,a=ey.ij(t,{type:"array"}),s=a.SheetNames[0],n=a.Sheets[s],r=ey.P6.decode_range(n["!ref"]??""),i=[];for(let e=4;e<=r.e.r;e++){let t=t=>n[ey.P6.encode_cell({r:e,c:t})];if(!t(1)&&!t(2)&&!t(3)&&!t(4))continue;let l=t(1)?.v?String(t(1).v).trim().toLowerCase().replace(/\s+/g," "):"",a=t(2)?.v?String(t(2).v).trim():"",s=t(3)?.v?String(t(3).v).trim():"",r=t(4)?.v?String(t(4).v).trim():"",c=t(5)?.v?Number(t(5).v):0,d=t(6)?.v?String(t(6).v).trim():"",o=t(7)?.w?t(7).w:"",h=t(8)?.w?t(8).w:"",x=t(9)?.v??"";i.push({name_contract:l,code_contract:a,project:s,customer:r,price:c,type_contract:d,date_start:o,date_expired:h,description:x,selected:!0,applied:!1})}let c=i.filter(e=>e.name_contract&&e.code_contract&&e.customer&&e.date_expired);if(0===c.length){d({type:"error",message:"Kh\xf4ng t\xecm thấy dữ liệu hợp lệ trong file!"});return}l(e=>[...e,...c]),d({type:"success",message:`Import th\xe0nh c\xf4ng ${c.length} hợp đồng!`}),Z(!0)}catch(e){console.error(e),d({type:"error",message:"Lỗi đọc file Excel — vui l\xf2ng kiểm tra lại!"})}},a.readAsArrayBuffer(t),e.target.value=""},className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",id:"excel-import"}),(0,a.jsxs)($.zx,{variant:"default",className:"gap-2 bg-emerald-600 hover:bg-emerald-700",children:[a.jsx(es.Z,{className:"h-4 w-4"}),"Import từ Excel"]})]}),(0,a.jsxs)($.zx,{onClick:()=>{eN(t)},variant:"outline",className:"gap-2 border-blue-500 text-blue-600 hover:bg-blue-50 bg-transparent",children:[a.jsx(el.Z,{className:"h-4 w-4"}),"Xuất Excel"]}),(0,a.jsxs)($.zx,{variant:"outline",onClick:()=>{j(!0)},className:"gap-2 border-orange-500 text-orange-600 hover:bg-orange-50 bg-transparent",children:[a.jsx(en.Z,{className:"h-4 w-4"}),"Xuất theo thời gian"]}),t.length>0&&(0,a.jsxs)($.zx,{onClick:()=>{l([]),d(null)},variant:"destructive",className:"gap-2 bg-red-500",children:[a.jsx(er.Z,{className:"h-4 w-4"}),"Xo\xe1 tất cả"]})]})})]}),c&&(0,a.jsxs)(ex,{variant:"success"===c.type?"default":"destructive",children:["success"===c.type?a.jsx(ei.Z,{className:"h-4 w-4"}):a.jsx(ec.Z,{className:"h-4 w-4"}),a.jsx(em,{children:"success"===c.type?"Th\xe0nh c\xf4ng":"Lỗi"}),a.jsx(ep,{children:c.message})]}),(0,a.jsxs)(Y.Zb,{children:[a.jsx(Y.Ol,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)(Y.ll,{className:"flex items-center gap-2",children:["Danh s\xe1ch hợp đồng",t.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(et.C,{variant:"secondary",children:[t.length," hợp đồng"]}),B>0&&(0,a.jsxs)(et.C,{variant:"default",className:"bg-emerald-600",children:[B," đ\xe3 apply"]}),P>0&&(0,a.jsxs)(et.C,{variant:"outline",className:"border-amber-500 text-amber-600",children:[P," chờ duyệt"]})]})]}),a.jsx(Y.SZ,{children:"Xem trước dữ liệu đ\xe3 import. Chọn c\xe1c hợp đồng cần ph\xea duyệt v\xe0 bấm Apply để lưu v\xe0o hệ thống."})]}),P>0&&(0,a.jsxs)($.zx,{className:"gap-2 bg-blue-600 hover:bg-blue-700",onClick:()=>{v(!0)},disabled:0===A||N,children:[N?a.jsx(ed.Z,{className:"h-4 w-4 animate-spin"}):a.jsx(eo.Z,{className:"h-4 w-4"}),"Apply (",A,")"]})]})}),a.jsx(Y.aY,{children:0===t.length?(0,a.jsxs)("div",{className:"text-center py-12 text-muted-foreground",children:[a.jsx(el.Z,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),a.jsx("p",{children:"Chưa c\xf3 dữ liệu. H\xe3y tải template mẫu v\xe0 import file Excel."})]}):a.jsx("div",{className:"overflow-x-auto rounded-lg border",children:(0,a.jsxs)(K,{children:[a.jsx(O,{children:(0,a.jsxs)(J,{className:"bg-muted/50",children:[a.jsx(Q,{className:"w-12",children:a.jsx(ej,{checked:_,onCheckedChange:()=>{let e=!_;Z(e),l(t=>t.map(t=>t.applied?t:{...t,selected:e}))},disabled:0===P})}),a.jsx(Q,{className:"font-semibold",children:"STT"}),a.jsx(Q,{className:"font-semibold",children:"T\xean hợp đồng"}),a.jsx(Q,{className:"font-semibold",children:"M\xe3 HD"}),a.jsx(Q,{className:"font-semibold",children:"Dự \xe1n"}),a.jsx(Q,{className:"font-semibold",children:"Kh\xe1ch h\xe0ng"}),a.jsx(Q,{className:"font-semibold text-right",children:"Gi\xe1 trị"}),a.jsx(Q,{className:"font-semibold",children:"Loại HD"}),a.jsx(Q,{className:"font-semibold",children:"Ng\xe0y bắt đầu"}),a.jsx(Q,{className:"font-semibold",children:"Ng\xe0y kết th\xfac"}),a.jsx(Q,{className:"font-semibold",children:"Trạng th\xe1i"})]})}),a.jsx(U,{children:t.map((e,t)=>(0,a.jsxs)(J,{className:e.applied?"bg-emerald-50":e.selected?"bg-blue-50":"",children:[a.jsx(ee,{children:a.jsx(ej,{checked:e.selected||!1,onCheckedChange:()=>I(t),disabled:e.applied})}),a.jsx(ee,{className:"font-medium",children:t+1}),a.jsx(ee,{className:"max-w-[200px] truncate",children:e.name_contract}),a.jsx(ee,{children:a.jsx(et.C,{variant:"outline",children:e.code_contract})}),a.jsx(ee,{children:e.project||"-"}),a.jsx(ee,{children:e.customer}),a.jsx(ee,{className:"text-right font-medium text-emerald-600",children:D(e.price)}),a.jsx(ee,{children:e.type_contract||"-"}),a.jsx(ee,{children:e.date_start||"-"}),a.jsx(ee,{children:e.date_expired}),a.jsx(ee,{children:e.applied?(0,a.jsxs)(et.C,{className:"bg-emerald-600",children:[a.jsx(ei.Z,{className:"h-3 w-3 mr-1"}),"Đ\xe3 apply"]}):a.jsx(et.C,{variant:"outline",className:"border-amber-500 text-amber-600",children:"Chờ duyệt"})})]},t))})]})})})]}),(0,a.jsxs)(i.Z,{title:(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[a.jsx(eC.xAl,{}),"Xuất hợp đồng theo thời gian"]}),open:f,onCancel:()=>{j(!1)},footer:[a.jsx($.zx,{onClick:()=>{j(!1)},children:"Hủy"},"cancel"),a.jsx($.zx,{onClick:()=>{F(),j(!1)},style:{backgroundColor:"#ea580c",borderColor:"#ea580c"},children:"Xuất Excel"},"export")],children:[a.jsx("p",{style:{marginTop:8,color:"#666"},children:"Chọn khoảng thời gian để lọc v\xe0 xuất c\xe1c hợp đồng."}),(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(eg._,{htmlFor:"date-from",children:"Từ ng\xe0y"}),a.jsx(eu.I,{id:"date-from",type:"date",value:h,onChange:e=>x(e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(eg._,{htmlFor:"date-to",children:"Đến ng\xe0y"}),a.jsx(eu.I,{id:"date-to",type:"date",value:m,onChange:e=>g(e.target.value)})]})]}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Để trống nếu kh\xf4ng muốn giới hạn ng\xe0y bắt đầu hoặc kết th\xfac"})]})]}),(0,a.jsxs)(i.Z,{open:y,onCancel:()=>{v(!1)},footer:[a.jsx($.zx,{onClick:()=>{v(!1)},children:"Hủy"},"cancel"),(0,a.jsxs)($.zx,{onClick:R,style:{backgroundColor:"#2563eb",borderColor:"#2563eb"},children:[N?a.jsx(ed.Z,{className:"h-4 w-4 animate-spin"}):a.jsx(eo.Z,{className:"h-4 w-4"}),"X\xe1c nhận Apply(",A,")"]},"apply")],title:"X\xe1c nhận Apply hợp đồng",children:[(0,a.jsxs)("p",{children:["Bạn c\xf3 chắc chắn muốn apply ",A," hợp đồng đ\xe3 chọn v\xe0o hệ thống database?"]}),(0,a.jsxs)("div",{style:{background:"#f5f5f5",padding:16,marginTop:16,borderRadius:8},children:[a.jsx("p",{style:{fontWeight:500},children:"Th\xf4ng tin apply:"}),(0,a.jsxs)("ul",{style:{marginTop:8,paddingLeft:16,color:"#555"},children:[(0,a.jsxs)("li",{children:["• Số hợp đồng sẽ apply:"," ",a.jsx("span",{style:{fontWeight:600,color:"#000"},children:A})]}),a.jsx("li",{children:"• C\xe1c hợp đồng đ\xe3 apply trước đ\xf3 sẽ kh\xf4ng bị ảnh hưởng"}),a.jsx("li",{children:"• Dữ liệu sẽ được lưu v\xe0o hệ thống database"})]})]})]})]})}var eZ=l(67427);function ek({refBtnImport:e}){let[t,l]=(0,s.useState)(!1);return(0,a.jsxs)(a.Fragment,{children:[a.jsx(n.ZP,{hidden:!!e,className:"bg-blue-400 border-0 text-white font-semibold",icon:a.jsx(eZ.Fb$,{}),onClick:()=>{l(!0)},ref:e}),a.jsx(i.Z,{title:"Quản l\xfd hợp đồng",open:t,onCancel:()=>{l(!1)},footer:null,width:"100%",style:{maxWidth:"800px"},children:a.jsx(e_,{})})]})}function eS(){let{datas:e}=(0,o.v9)(e=>e.get_contract_about),{customerID:t}=(0,D.useParams)();return(0,a.jsxs)("div",{className:"flex items-start gap-4 w-full flex-col",children:[(0,a.jsxs)("div",{className:"flex gap-2 items-center flex-wrap",children:[a.jsx(X.Z,{}),a.jsx(_.Z,{}),a.jsx(ek,{}),a.jsx(n.ZP,{icon:a.jsx(G.yQE,{}),hidden:!!t})]}),(0,a.jsxs)("div",{className:"w-full",hidden:!!t,children:[a.jsx("h2",{className:"font-semibold text-[#1BA399]",children:"Tổng quan hợp đồng"}),(0,a.jsxs)("div",{className:"flex justify-around gap-2 flex-wrap",children:[(0,a.jsxs)(M.Z,{className:"lex flex-col pl-4 pt-8 rounded-lg gap-2 min-w-fit flex-1 h-32 border-0 shadow-lg shadow-black/20 bg-[#EB8823]",children:[a.jsx("p",{className:"font-bold text-3xl text-white",children:e?.contractTotal.toLocaleString("vi-VN")}),a.jsx("p",{className:"text-xs text-wrap text-slate-50/80 min-w-36",children:"Tổng số hợp đồng"})]}),(0,a.jsxs)(M.Z,{className:"lex flex-col pl-4 pt-8 rounded-lg gap-2 min-w-fit flex-1 h-32 bg-[#EB8823] border-0 shadow-lg  shadow-black/20",children:[a.jsx("p",{className:"font-bold text-3xl text-white",children:e?.contractActive.toLocaleString("vi-VN")}),a.jsx("p",{className:"text-xs text-wrap text-slate-50/80 min-w-36",children:"Đang hoạt động"})]}),(0,a.jsxs)(M.Z,{className:"lex flex-col pl-4 pt-8 rounded-lg gap-2 min-w-fit flex-1 h-32 bg-[#EB8823] border-0 shadow-lg  shadow-black/20",children:[a.jsx("p",{className:"font-bold text-3xl text-white",children:e?.contractReadyExpired.toLocaleString("vi-VN")}),a.jsx("p",{className:"text-xs text-wrap text-slate-50/80 min-w-36",children:"Sắp hết hạn"})]}),(0,a.jsxs)(M.Z,{className:"lex flex-col pl-4 pt-8 rounded-lg gap-2 min-w-fit flex-1 h-32 bg-[#EB8823] border-0 shadow-lg  shadow-black/20",children:[a.jsx("p",{className:"font-bold text-3xl text-white",children:e?.contractExpired.toLocaleString("vi-VN")}),a.jsx("p",{className:"text-xs text-wrap text-slate-50/80 min-w-36",children:"Hết hạn"})]})]})]})]})}var eT=l(80669);function eD(){let[e,t]=(0,s.useState)([]);return(0,a.jsxs)("div",{className:"sm:px-4 py-4 flex flex-col gap-4 max-w-full",children:[a.jsx("p",{className:"p-4 text-xl font-semibold",children:"Hợp đồng theo loại"}),a.jsx("div",{className:"w-full",children:a.jsx(()=>a.jsx(eT.Z,{data:e,xField:"type",yField:"value",style:{fill:()=>"#2989FF"},xAxis:{label:{style:{fill:"#FF0000",rotate:Math.PI/4}}},legend:!1}),{})})]})}var eF=l(24673);function eI(){let[e,t]=(0,s.useState)([]);return(0,a.jsxs)("div",{className:"p-4 flex flex-col gap-4 max-w-full",children:[a.jsx("p",{className:"p-4 text-xl font-semibold",children:"Hợp đồng theo loại"}),a.jsx("div",{className:"w-full",children:a.jsx(()=>a.jsx(eF.Z,{data:e,xField:"type",yField:"value",style:{fill:()=>"#2989FF"},xAxis:{label:{style:{fill:"#FF0000",rotate:Math.PI/4}}},legend:!1}),{})})]})}function eR(){return(0,a.jsxs)("div",{className:"flex w-full flex-wrap shadow-[0_8px_30px_rgb(0,0,0,0.12)]",children:[a.jsx("div",{className:"flex-1 min-w-80",children:a.jsx(eD,{})}),a.jsx("div",{className:"flex-1 min-w-80",children:a.jsx(eI,{})})]})}function eA(){let{customerID:e}=(0,D.useParams)(),t=(0,E.Z)(["admin-top","contract","contract-edit"]);return(0,a.jsxs)("div",{className:"flex flex-col gap-4 rounded-md p-4 shadow-[0_8px_30px_rgb(0,0,0,0.12)] bg-white",children:[t&&a.jsx("div",{className:"rounded-md",children:a.jsx(eS,{})}),!e&&a.jsx("div",{className:"flex",hidden:!!e,children:a.jsx(eR,{})}),a.jsx("div",{className:"rounded-md",children:a.jsx(z,{})})]})}},85426:(e,t,l)=>{l.d(t,{I:()=>r});var a=l(97247),s=l(28964),n=l(40677);let r=s.forwardRef(({className:e,type:t,...l},s)=>a.jsx("input",{type:t,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:s,...l}));r.displayName="Input"}};