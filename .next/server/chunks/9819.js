"use strict";exports.id=9819,exports.ids=[9819],exports.modules={19819:(e,t,i)=>{i.d(t,{Z:()=>Y});var l=i(97247),s=i(99539),r=i(77784),n=i(9914),a=i(88192),c=i(77951),d=i(61410),o=i(82140),h=i(31464),u=i(92177),m=i(39884),x=i(12927),p=i(95718),y=i(1880),j=i(35090),f=i(88506),g=i(69160),v=i(41201),w=i(75142),C=i(28964),Z=i(38043),_=i(23102),k=i(86424),b=i(73176),W=i(24989),N=i(37694),P=i(99801),F=i.n(P),S=i(34178),T=i(48738),L=i(77660);function Y({ID:e,idType:t,refBtn:i,setID:P,type:Y}){let{projectID:A}=(0,S.useParams)(),[I,V]=(0,C.useState)([]),B=(0,C.useRef)(null),R=(0,C.useRef)(),D=(0,C.useRef)(),M=(0,C.useRef)(),{datas:E}=(0,_.v9)(e=>e.get_type_work),{datas:O}=(0,_.v9)(e=>e.get_users),{datas:q}=(0,_.v9)(e=>e.get_projects),{datas:G}=(0,_.v9)(e=>e.get_activities),[H,z]=(0,C.useState)(!1),[K,U]=(0,C.useState)([]),[$,J]=(0,C.useState)([]),[Q]=(0,g.Z)(),{postdata:X}=(0,s.Z)(),ee=(0,_.I0)(),[et,ei]=(0,C.useState)(!1),[el,es]=(0,C.useState)(""),er=async()=>{let t=await a.Z.getWorkById(e);if(200===t.statusCode){let e=t.data;Q.setFieldsValue({...e,type:e?.type?.type_work_id,status:e?.status?.status_work_id,activity:e?.activity?.activity_id}),V(e.picture_urls?.map(e=>({uid:e.picture_id,name:e.type,status:"done",url:e.url}))??[]),es(e?.type?.type_work_id),J(e?.list_user?.map(e=>e.user_id)??[])}},en=async i=>{let l=await X(()=>a.Z.updateWork(e,{...i,list_users:$}));(200===l||201===l)&&(ee((0,n.LG)({project:A})),ei(!1),"schedule"===Y&&ee((0,N.C)(t)))},ea=async({file:i},l)=>{if(i?.url&&i?.status==="removed")200===await X(()=>a.Z.deletePictureWork(i.uid))&&(er(),"schedule"===Y&&ee((0,N.C)(t)));else{let s={activity:e,url:[i.originFileObj],type:l?"start":"end"};if(s){let e=(0,T.Z)(s);201===await X(()=>a.Z.createPictureWork(e))&&(er(),"schedule"===Y&&ee((0,N.C)(t)))}}},ec=async()=>{Q.submit()},ed=(0,l.jsxs)("button",{style:{border:0,background:"none"},type:"button",children:[l.jsx(r.Z,{}),l.jsx("div",{style:{marginTop:8},children:"Upload"})]});return(0,l.jsxs)(l.Fragment,{children:[l.jsx(c.ZP,{hidden:!!Y||!!i,className:"  text-xs text-yellow-500 font-semibold",type:"text",ref:i,onClick:()=>{ei(!0),er()},children:"Chỉnh sửa"}),(0,l.jsxs)(d.Z,{title:"Cập nhật c\xf4ng việc",open:et,onCancel:()=>{ei(!1),P&&P("")},footer:null,width:"100%",style:{maxWidth:"800px"},children:[l.jsx(o.Z,{defaultActiveKey:"1",style:{width:"100%"},type:"line",children:(0,l.jsxs)(w.Z,{tab:"Th\xf4ng tin c\xf4ng việc",children:[(0,l.jsxs)("div",{className:"flex mb-2 items-center gap-1",children:[l.jsx(h.C.Group,{max:{count:5,style:{color:"#f56a00",backgroundColor:"#fde3cf"}},children:$?.map(e=>{let t=O?.find(t=>t.user_id===e);return l.jsx(u.Z,{title:t?.first_name??t?.last_name??"",placement:"top",children:l.jsx(h.C,{src:t?.picture_url,alt:t?.first_name??t?.last_name??"",style:{backgroundColor:"#87d068"}})})})}),H?(0,l.jsxs)(l.Fragment,{children:[l.jsx(m.Z,{mode:"multiple",onBlur:()=>{z(!H)},allowClear:!0,maxTagCount:"responsive",style:{width:"220px"},value:$,placeholder:"Please select",onChange:e=>{J(e)},options:K}),l.jsx(Z.FMH,{className:"w-8 h-8 text-red-500 cursor-pointer",onClick:()=>{z(!H)}})]}):l.jsx(Z.S$f,{className:"w-8 h-8 text-[#ED8C1F] cursor-pointer",onClick:()=>{z(!H)}})]}),(0,l.jsxs)(x.Z,{layout:"vertical",form:Q,onFinish:en,style:{display:"flex",flexWrap:"wrap",gap:"12px"},children:[l.jsx(x.Z.Item,{name:"type",label:"Loại c\xf4ng việc",rules:[{required:!0,message:"Vui l\xf2ng chọn loại c\xf4ng việc!"}],style:{width:"100%",flex:"1 1 0%"},children:l.jsx(m.Z,{placeholder:"Chọn loại",onChange:e=>{es(e)},showSearch:!0,filterOption:(e,t)=>(Array.isArray(t?.children)?t.children.join(""):t?.children??"").toLowerCase().includes(e.toLowerCase()),dropdownRender:e=>(0,l.jsxs)(l.Fragment,{children:[e,l.jsx(p.Z,{style:{margin:"8px 0"}}),l.jsx(c.ZP,{type:"link",onClick:()=>{R.current?.click()},children:"+ Th\xeam t\xf9y chọn mới"})]}),children:E?.map(e=>l.jsx(v.W,{value:e.type_work_id,children:e.name},e.type_work_id))})}),l.jsx(x.Z.Item,{name:"name",label:"T\xean c\xf4ng việc",rules:[{required:!0,type:"string",message:"Vui l\xf2ng nhập t\xean c\xf4ng việc"}],style:{minWidth:"100%",flex:"1 1 0%"},children:l.jsx(y.default,{})}),l.jsx(x.Z.Item,{name:"project",label:"C\xf4ng tr\xecnh",rules:[{required:!0,message:"Vui l\xf2ng chọn c\xf4ng tr\xecnh!"}],style:{minWidth:"320px",flex:"1 1 0%"},children:l.jsx(m.Z,{placeholder:"Chọn c\xf4ng tr\xecnh",showSearch:!0,filterOption:(e,t)=>(Array.isArray(t?.children)?t.children.join(""):t?.children??"").toLowerCase().includes(e.toLowerCase()),dropdownRender:e=>(0,l.jsxs)(l.Fragment,{children:[e,l.jsx(p.Z,{style:{margin:"8px 0"}}),l.jsx(c.ZP,{type:"link",onClick:()=>{B.current?.click()},children:"+ Th\xeam t\xf9y chọn mới"})]}),children:q?.map(e=>l.jsx(v.W,{value:e.project_id,children:e.name},e.project_id))})}),l.jsx(x.Z.Item,{name:"status",label:"Trạng th\xe1i",style:{minWidth:"240px",flex:"1 1 0%"},children:l.jsx(m.Z,{placeholder:"Chọn trạng th\xe1i",showSearch:!0,filterOption:(e,t)=>(Array.isArray(t?.children)?t.children.join(""):t?.children??"").toLowerCase().includes(e.toLowerCase()),dropdownRender:e=>(0,l.jsxs)(l.Fragment,{children:[e,l.jsx(p.Z,{style:{margin:"8px 0"}}),l.jsx(c.ZP,{type:"link",onClick:()=>{D.current?.click()},children:"+ Th\xeam t\xf9y chọn mới"})]}),children:E.find(e=>e.type_work_id===el)?.status?.map(e=>l.jsx(v.W,{value:e.status_work_id,children:e.name},e.status_work_id))})}),l.jsx(x.Z.Item,{name:"activity",label:"Hoạt động",style:{minWidth:"240px",flex:"1 1 0%"},children:l.jsx(m.Z,{placeholder:"Chọn hoạt động",showSearch:!0,filterOption:(e,t)=>(Array.isArray(t?.children)?t.children.join(""):t?.children??"").toLowerCase().includes(e.toLowerCase()),dropdownRender:e=>(0,l.jsxs)(l.Fragment,{children:[e,l.jsx(p.Z,{style:{margin:"8px 0"}}),l.jsx(c.ZP,{type:"link",onClick:()=>{M.current?.click()},children:"+ Th\xeam t\xf9y chọn mới"})]}),children:G?.map(e=>l.jsx(v.W,{value:e.activity_id,children:e.name},e.activity_id))})}),l.jsx(x.Z.Item,{name:"description",label:"M\xf4 tả",style:{width:"100%"},children:l.jsx(y.default.TextArea,{placeholder:"Description",autoSize:{minRows:3}})}),l.jsx(x.Z.Item,{name:"time_start",initialValue:"",className:" mb-0",style:{minWidth:"320px",flex:"1 1 0%"},getValueFromEvent:e=>e?.format("YYYY-MM-DD"),getValueProps:e=>({value:e?F()(e):""}),children:l.jsx(j.default,{placeholder:"Chọn ng\xe0y bắt đầu",style:{width:"100%"}})}),l.jsx(x.Z.Item,{name:"time_end",rules:[{required:!0}],initialValue:"",className:" mb-0",style:{minWidth:"320px",flex:"1 1 0%"},getValueFromEvent:e=>e?.format("YYYY-MM-DD"),getValueProps:e=>({value:e?F()(e):""}),children:l.jsx(j.default,{placeholder:"Chọn ng\xe0y kết th\xfac",style:{width:"100%"},format:"YYYY-MM-DD",allowClear:!0})})]}),(0,l.jsxs)("div",{className:"my-2 flex flex-col gap-8",children:[(0,l.jsxs)("div",{className:"mb-2  pb-2",children:[l.jsx("div",{className:"flex items-center text-xs font-medium text-[#EB8823] hover:opacity-85 cursor-pointer mb-2",children:l.jsx("p",{className:"pointer-events-none",children:"Ảnh đầu hoạt động"})}),l.jsx("div",{className:"!m-0",style:{minWidth:"320px",flex:"1 1 0%"},children:l.jsx(f.default,{action:"",listType:"picture-card",fileList:I.filter(e=>"start"===e.name),onChange:e=>{ea(e,!0)},onPreview:e=>{ee((0,L.BZ)(e.url))},multiple:!0,children:ed})})]}),(0,l.jsxs)("div",{children:[l.jsx("div",{className:"flex items-center text-xs font-medium text-[#EB8823] hover:opacity-85 cursor-pointer mb-2",children:l.jsx("p",{className:"pointer-events-none",children:"Ảnh sau hoạt động"})}),l.jsx("div",{className:"!m-0",style:{minWidth:"320px",flex:"1 1 0%"},children:l.jsx(f.default,{action:"",listType:"picture-card",fileList:I.filter(e=>"end"===e.name),onPreview:e=>{ee((0,L.BZ)(e.url))},onChange:e=>{ea(e,!1)},multiple:!0,children:ed})})]})]})]},1)}),l.jsx("div",{className:"flex justify-end w-full mt-4",children:l.jsx(c.ZP,{type:"primary",onClick:ec,children:"Cập nhật"})})]}),l.jsx(k.Z,{refBtnType:R}),l.jsx(b.Z,{refBtnStatus:D}),l.jsx(W.Z,{refBtnActivity:M})]})}}};