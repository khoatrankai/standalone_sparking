"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6246],{6246:function(e,t,s){let a;s.d(t,{default:function(){return ex}});var r=s(57437),l=s(2265),n=s(12381),i=s(40279),o=s(69174),c=s(96246),d=s(20271),m=s(93448);let u=d.fC,x=l.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(d.aV,{ref:t,className:(0,m.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...a})});x.displayName=d.aV.displayName;let h=l.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(d.xz,{ref:t,className:(0,m.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...a})});h.displayName=d.xz.displayName;let p=l.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(d.VY,{ref:t,className:(0,m.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...a})});p.displayName=d.VY.displayName;var f=s(95805),g=s(73247),v=s(82718),j=s(74291),N=s(78049),y=s(99376);function b(e){var t;let{open:s,onOpenChange:a,users:n,chats:o,currentUser:d,onChatCreated:m}=e,{projectID:u}=(0,y.useParams)(),[x,h]=(0,l.useState)(""),[p,f]=(0,l.useState)(!1),b=null!==(t=o.map(e=>e.user_one).concat(o.map(e=>e.user_two)))&&void 0!==t?t:[],w=n.filter(e=>e.user_id!==d&&!b.includes(e.user_id)&&(e.first_name+" "+e.last_name).toLowerCase().includes(x.toLowerCase())),C=async e=>{f(!0);try{let t=await N.Z.createChat({user_two:e.user_id,project:null!=u?u:""});if(201===t.statusCode){let e=await t.data;m({...e,type:"direct"}),a(!1),h("")}}catch(e){console.error("Failed to create chat:",e)}finally{f(!1)}},_=e=>(e.first_name+" "+e.last_name).split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2);return(0,r.jsx)(j.Vq,{open:s,onOpenChange:a,children:(0,r.jsxs)(j.cZ,{className:"sm:max-w-md",children:[(0,r.jsx)(j.fK,{children:(0,r.jsxs)(j.$N,{className:"flex items-center",children:[(0,r.jsx)(v.Z,{className:"w-5 h-5 mr-2"}),"Start New Conversation"]})}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(g.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),(0,r.jsx)(i.I,{placeholder:"Search users...",value:x,onChange:e=>h(e.target.value),className:"pl-10"})]}),(0,r.jsxs)("div",{className:"max-h-60 overflow-y-auto space-y-2",children:[w.map(e=>(0,r.jsxs)("div",{className:"flex items-center p-3 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>C(e),children:[(0,r.jsx)(c.qE,{className:"w-10 h-10 mr-3",children:(0,r.jsx)(c.Q5,{className:"bg-green-100 text-green-600",children:_(e)})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h3",{className:"font-medium text-sm",children:e.first_name+" "+e.last_name}),e.email&&(0,r.jsx)("p",{className:"text-xs text-gray-600",children:e.email})]}),p&&(0,r.jsx)("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"})]},e.user_id)),0===w.length&&x&&(0,r.jsx)("div",{className:"text-center py-8 text-gray-500",children:(0,r.jsx)("p",{className:"text-sm",children:"No users found"})}),0===w.length&&!x&&(0,r.jsx)("div",{className:"text-center py-8 text-gray-500",children:(0,r.jsx)("p",{className:"text-sm",children:"Start typing to search for users"})})]})]})]})})}var w=s(23675),C=s(32489);function _(e){let{open:t,onOpenChange:s,users:a,currentUser:d,onGroupCreated:m}=e,{projectID:u}=(0,y.useParams)(),[x,h]=(0,l.useState)(""),[p,v]=(0,l.useState)(""),[b,_]=(0,l.useState)(""),[k,Z]=(0,l.useState)([]),[S,z]=(0,l.useState)(!1),U=a.filter(e=>e.user_id!==d&&(e.first_name+" "+e.last_name).toLowerCase().includes(b.toLowerCase())&&!k.find(t=>t.user_id===e.user_id)),D=e=>{Z(t=>[...t,e]),_("")},T=e=>{Z(t=>t.filter(t=>t.user_id!==e))},F=async()=>{if(x.trim()&&0!==k.length){z(!0);try{let e=await N.Z.createChatGroup({name:x,description:p,members:k.map(e=>e.user_id),project:u});if(201===e.statusCode){let t=null==e?void 0:e.data;m({...t,type:"group"}),s(!1),h(""),v(""),Z([]),_("")}}catch(e){console.error("Failed to create group:",e)}finally{z(!1)}}},R=e=>(e.first_name+" "+e.last_name).split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2);return(0,r.jsx)(j.Vq,{open:t,onOpenChange:s,children:(0,r.jsxs)(j.cZ,{className:"sm:max-w-lg",children:[(0,r.jsx)(j.fK,{children:(0,r.jsxs)(j.$N,{className:"flex items-center",children:[(0,r.jsx)(f.Z,{className:"w-5 h-5 mr-2"}),"Create New Group"]})}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"Group Name"}),(0,r.jsx)(i.I,{placeholder:"Enter group name...",value:x,onChange:e=>h(e.target.value)})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"Description (Optional)"}),(0,r.jsx)(w.g,{placeholder:"Enter group description...",value:p,onChange:e=>v(e.target.value),rows:2})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"Add Members"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(g.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),(0,r.jsx)(i.I,{placeholder:"Search users...",value:b,onChange:e=>_(e.target.value),className:"pl-10"})]})]}),k.length>0&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("label",{className:"text-sm font-medium",children:["Selected Members (",k.length,")"]}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:k.map(e=>(0,r.jsxs)(o.C,{variant:"secondary",className:"flex items-center gap-1",children:[e.first_name+" "+e.last_name,(0,r.jsx)(C.Z,{className:"w-3 h-3 cursor-pointer hover:text-red-500",onClick:()=>T(e.user_id)})]},e.user_id))})]}),(0,r.jsxs)("div",{className:"max-h-40 overflow-y-auto space-y-2",children:[U.map(e=>(0,r.jsxs)("div",{className:"flex items-center p-2 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>D(e),children:[(0,r.jsx)(c.qE,{className:"w-8 h-8 mr-3",children:(0,r.jsx)(c.Q5,{className:"bg-purple-100 text-purple-600 text-xs",children:R(e)})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h3",{className:"font-medium text-sm",children:e.first_name+" "+e.last_name}),e.email&&(0,r.jsx)("p",{className:"text-xs text-gray-600",children:e.email})]})]},e.user_id)),0===U.length&&b&&(0,r.jsx)("div",{className:"text-center py-4 text-gray-500",children:(0,r.jsx)("p",{className:"text-sm",children:"No users found"})})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-2 pt-4 border-t",children:[(0,r.jsx)(n.zx,{variant:"outline",onClick:()=>s(!1),children:"Cancel"}),(0,r.jsxs)(n.zx,{onClick:F,disabled:!x.trim()||0===k.length||S,children:[S?(0,r.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}):null,"Create Group"]})]})]})]})})}function k(e){let{chats:t,users:s,selectedChat:a,onSelectChat:d,onNewChat:m,currentUser:j}=e,[N,y]=(0,l.useState)(""),[w,C]=(0,l.useState)(!1),[k,Z]=(0,l.useState)(!1),S=t.filter(e=>"direct"===e.type),z=t.filter(e=>"group"===e.type),U=S.filter(e=>e.name_one.toLowerCase().includes(N.toLowerCase())||e.name_two.toLowerCase().includes(N.toLowerCase())),D=z.filter(e=>e.name.toLowerCase().includes(N.toLowerCase())),T=e=>"direct"===e.type?(console.log(j),e.user_one===j?e.name_two:e.name_one):e.name,F=e=>T(e).split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2),R=e=>{let t=new Date(e),s=new Date,a=String(t.getUTCHours()).padStart(2,"0"),r=String(t.getUTCMinutes()).padStart(2,"0");if(t.getUTCDate()!==s.getUTCDate()||t.getUTCMonth()!==s.getUTCMonth()||t.getUTCFullYear()!==s.getUTCFullYear()){let e=String(t.getUTCDate()).padStart(2,"0"),s=String(t.getUTCMonth()+1).padStart(2,"0"),l=t.getUTCFullYear();return"".concat(e,"-").concat(s,"-").concat(l," ").concat(a,":").concat(r)}return"".concat(a,":").concat(r)},E=e=>{var t,s,l,n,i,m,u,x,h;let{chat:p}=e;return(0,r.jsxs)("div",{className:"flex items-center p-3 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors ".concat((null==a?void 0:a.id)===p.id?"bg-blue-50 border-l-4 border-blue-500":""),onClick:()=>d(p),children:[(0,r.jsx)(c.qE,{className:"w-10 h-10 mr-3 flex-shrink-0",children:(0,r.jsx)(c.Q5,{className:"bg-blue-100 text-blue-600",children:F(p)})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,r.jsx)("h3",{className:"font-medium truncate text-sm pr-2",children:T(p)}),(null===(s=p.contents)||void 0===s?void 0:null===(t=s[0])||void 0===t?void 0:t.content)&&(0,r.jsx)("span",{className:"text-xs text-gray-500 flex-shrink-0",children:R(null==p?void 0:null===(n=p.contents)||void 0===n?void 0:null===(l=n[0])||void 0===l?void 0:l.created_at)})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(null===(m=p.contents)||void 0===m?void 0:null===(i=m[0])||void 0===i?void 0:i.content)&&(0,r.jsx)("p",{className:"text-xs text-gray-600 truncate flex-1 pr-2",children:null===(x=p.contents)||void 0===x?void 0:null===(u=x[0])||void 0===u?void 0:u.content}),"group"===p.type&&(0,r.jsxs)(o.C,{variant:"secondary",className:"text-xs flex-shrink-0",children:[(0,r.jsx)(f.Z,{className:"w-3 h-3 mr-1"}),(null===(h=p.members)||void 0===h?void 0:h.length)||0]})]})]})]})};return(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsxs)("div",{className:"p-4 border-b",children:[(0,r.jsx)("h1",{className:"text-xl font-bold mb-4",children:"Messages"}),(0,r.jsxs)("div",{className:"relative mb-3",children:[(0,r.jsx)(g.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),(0,r.jsx)(i.I,{placeholder:"Search conversations...",value:N,onChange:e=>y(e.target.value),className:"pl-10"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)(n.zx,{size:"sm",className:"flex-1 bg-blue-500",onClick:()=>C(!0),children:[(0,r.jsx)(v.Z,{className:"w-4 h-4 mr-1 text-white"}),"New Chat"]}),(0,r.jsxs)(n.zx,{size:"sm",variant:"outline",className:"flex-1 bg-transparent",onClick:()=>Z(!0),children:[(0,r.jsx)(f.Z,{className:"w-4 h-4 mr-1"}),"New Group"]})]})]}),(0,r.jsxs)(u,{defaultValue:"all",className:"flex-1 flex flex-col",children:[(0,r.jsxs)(x,{className:"grid w-auto grid-cols-3 mx-4 mt-2",children:[(0,r.jsx)(h,{value:"all",className:"text-xs",children:"All"}),(0,r.jsxs)(h,{value:"direct",className:"text-xs",children:[(0,r.jsx)(v.Z,{className:"w-3 h-3 mr-1"}),"Direct"]}),(0,r.jsxs)(h,{value:"groups",className:"text-xs",children:[(0,r.jsx)(f.Z,{className:"w-3 h-3 mr-1"}),"Groups"]})]}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto",children:[(0,r.jsx)(p,{value:"all",className:"mt-0",children:(0,r.jsxs)("div",{className:"space-y-1 p-2",children:[[...U,...D].sort((e,t)=>{var s,a,r,l,n,i,o,c;let d=(null==e?void 0:null===(a=e.contents)||void 0===a?void 0:null===(s=a[0])||void 0===s?void 0:s.created_at)?new Date(null==e?void 0:null===(l=e.contents)||void 0===l?void 0:null===(r=l[0])||void 0===r?void 0:r.created_at).getTime():e.created_at?new Date(e.created_at).getTime():0;return((null==t?void 0:null===(i=t.contents)||void 0===i?void 0:null===(n=i[0])||void 0===n?void 0:n.created_at)?new Date(null==t?void 0:null===(c=t.contents)||void 0===c?void 0:null===(o=c[0])||void 0===o?void 0:o.created_at).getTime():t.created_at?new Date(t.created_at).getTime():0)-d}).map(e=>(0,r.jsx)(E,{chat:e},e.id)),0==[...U,...D].length&&(0,r.jsx)("div",{className:"text-center py-8 text-gray-500",children:(0,r.jsx)("p",{className:"text-sm",children:"No conversations found"})})]})}),(0,r.jsx)(p,{value:"direct",className:"mt-0",children:(0,r.jsxs)("div",{className:"space-y-1 p-2",children:[U.map(e=>(0,r.jsx)(E,{chat:e},e.id)),0===U.length&&(0,r.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,r.jsx)("p",{className:"text-sm",children:"No direct messages"}),(0,r.jsx)(n.zx,{size:"sm",variant:"outline",className:"mt-2 bg-transparent",onClick:()=>C(!0),children:"Start a conversation"})]})]})}),(0,r.jsx)(p,{value:"groups",className:"mt-0",children:(0,r.jsxs)("div",{className:"space-y-1 p-2",children:[D.map(e=>(0,r.jsx)(E,{chat:e},e.id)),0===D.length&&(0,r.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,r.jsx)("p",{className:"text-sm",children:"No group chats"}),(0,r.jsx)(n.zx,{size:"sm",variant:"outline",className:"mt-2 bg-transparent",onClick:()=>Z(!0),children:"Create a group"})]})]})})]})]}),(0,r.jsx)(b,{open:w,onOpenChange:C,users:s,chats:t.filter(e=>"direct"===e.type),currentUser:j,onChatCreated:m}),(0,r.jsx)(_,{open:k,onOpenChange:Z,users:s,currentUser:j,onGroupCreated:m})]})}var Z=s(66182),S=s(10407),z=s(30401),U=s(40519);let D=Z.fC,T=Z.xz;Z.ZA,Z.Uv,Z.Tr,Z.Ee,l.forwardRef((e,t)=>{let{className:s,inset:a,children:l,...n}=e;return(0,r.jsxs)(Z.fF,{ref:t,className:(0,m.cn)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",a&&"pl-8",s),...n,children:[l,(0,r.jsx)(S.Z,{className:"ml-auto h-4 w-4"})]})}).displayName=Z.fF.displayName,l.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(Z.tu,{ref:t,className:(0,m.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...a})}).displayName=Z.tu.displayName;let F=l.forwardRef((e,t)=>{let{className:s,sideOffset:a=4,...l}=e;return(0,r.jsx)(Z.Uv,{children:(0,r.jsx)(Z.VY,{ref:t,sideOffset:a,className:(0,m.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...l})})});F.displayName=Z.VY.displayName;let R=l.forwardRef((e,t)=>{let{className:s,inset:a,...l}=e;return(0,r.jsx)(Z.ck,{ref:t,className:(0,m.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a&&"pl-8",s),...l})});R.displayName=Z.ck.displayName,l.forwardRef((e,t)=>{let{className:s,children:a,checked:l,...n}=e;return(0,r.jsxs)(Z.oC,{ref:t,className:(0,m.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:l,...n,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(Z.wU,{children:(0,r.jsx)(z.Z,{className:"h-4 w-4"})})}),a]})}).displayName=Z.oC.displayName,l.forwardRef((e,t)=>{let{className:s,children:a,...l}=e;return(0,r.jsxs)(Z.Rk,{ref:t,className:(0,m.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...l,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(Z.wU,{children:(0,r.jsx)(U.Z,{className:"h-2 w-2 fill-current"})})}),a]})}).displayName=Z.Rk.displayName,l.forwardRef((e,t)=>{let{className:s,inset:a,...l}=e;return(0,r.jsx)(Z.__,{ref:t,className:(0,m.cn)("px-2 py-1.5 text-sm font-semibold",a&&"pl-8",s),...l})}).displayName=Z.__.displayName;let E=l.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(Z.Z0,{ref:t,className:(0,m.cn)("-mx-1 my-1 h-px bg-muted",s),...a})});E.displayName=Z.Z0.displayName;var A=s(71533),M=s(15868),G=s(98728),O=s(37806),V=s(18930),Y=s(47692),L=s(76980),q=s(44743),I=s(98617),P=s(48837);function W(e){let{open:t,onOpenChange:s,chat:a,users:d,currentUser:m,onChatUpdate:u,isHead:x}=e,[h,p]=(0,l.useState)([]),[v,N]=(0,l.useState)(""),[y,b]=(0,l.useState)(!1),[w,C]=(0,l.useState)(!1);(0,l.useEffect)(()=>{t&&"group"===a.type&&_()},[t,a.id]);let _=async()=>{try{let e=await fetch("/api/chat-groups/".concat(a.id,"/members")),t=await e.json();p(t)}catch(e){console.error("Failed to fetch members:",e)}},k=async e=>{C(!0);try{(await fetch("/api/chat-groups/".concat(a.id,"/members"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e})})).ok&&(_(),"group"===a.type&&u({...a}))}catch(e){console.error("Failed to add member:",e)}finally{C(!1)}},Z=async e=>{C(!0);try{(await fetch("/api/chat-groups/".concat(a.id,"/members/").concat(e),{method:"DELETE"})).ok&&(_(),"group"===a.type&&u({...a}))}catch(e){console.error("Failed to remove member:",e)}finally{C(!1)}},S=d.filter(e=>e.user_id!==m&&!h.find(t=>t.user===e.user_id)&&(e.first_name+" "+e.last_name).toLowerCase().includes(v.toLowerCase())),z=h.filter(e=>e.name.toLowerCase().includes(v.toLowerCase())),U=e=>e.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2);return"group"!==a.type?null:(0,r.jsx)(j.Vq,{open:t,onOpenChange:s,children:(0,r.jsxs)(j.cZ,{className:"sm:max-w-lg",children:[(0,r.jsx)(j.fK,{children:(0,r.jsxs)(j.$N,{className:"flex items-center",children:[(0,r.jsx)(f.Z,{className:"w-5 h-5 mr-2"}),x?"Manage Members":"Group Members"]})}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(g.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),(0,r.jsx)(i.I,{placeholder:"Search members...",value:v,onChange:e=>N(e.target.value),className:"pl-10"})]}),x&&(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("span",{className:"text-sm font-medium",children:["Members (",h.length,")"]}),(0,r.jsxs)(n.zx,{size:"sm",variant:"outline",onClick:()=>b(!y),children:[(0,r.jsx)(O.Z,{className:"w-4 h-4 mr-1"}),"Add Members"]})]}),y&&x&&(0,r.jsxs)("div",{className:"border rounded-lg p-3 space-y-2",children:[(0,r.jsx)("h4",{className:"text-sm font-medium",children:"Add New Members"}),(0,r.jsxs)("div",{className:"max-h-32 overflow-y-auto space-y-2",children:[S.map(e=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-2 hover:bg-gray-50 rounded",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(c.qE,{className:"w-8 h-8 mr-2",children:(0,r.jsx)(c.Q5,{className:"bg-green-100 text-green-600 text-xs",children:U(e.first_name+" "+e.last_name)})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium",children:e.first_name+" "+e.last_name}),e.email&&(0,r.jsx)("p",{className:"text-xs text-gray-600",children:e.email})]})]}),(0,r.jsx)(n.zx,{size:"sm",variant:"outline",onClick:()=>k(e.user_id),disabled:w,children:"Add"})]},e.user_id)),0===S.length&&(0,r.jsx)("p",{className:"text-sm text-gray-500 text-center py-2",children:"No users available to add"})]})]}),(0,r.jsx)("div",{className:"max-h-60 overflow-y-auto space-y-2",children:z.map(e=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 rounded",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(c.qE,{className:"w-10 h-10 mr-3",children:(0,r.jsx)(c.Q5,{className:"bg-blue-100 text-blue-600",children:U(e.name)})}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("p",{className:"text-sm font-medium",children:e.name}),"admin"===e.role&&(0,r.jsx)(I.Z,{className:"w-4 h-4 ml-2 text-yellow-500"}),e.user===m&&(0,r.jsx)(o.C,{variant:"secondary",className:"ml-2 text-xs",children:"You"})]}),(0,r.jsx)("p",{className:"text-xs text-gray-600 capitalize",children:e.role})]})]}),x&&e.user!==m&&e.user!==a.head&&(0,r.jsx)(n.zx,{size:"sm",variant:"outline",onClick:()=>Z(e.user),disabled:w,className:"text-red-600 hover:text-red-700",children:(0,r.jsx)(P.Z,{className:"w-4 h-4"})})]},e.id))})]})]})})}function H(e){let{open:t,onOpenChange:s,chat:a,onChatUpdate:o,isHead:c}=e,[d,m]=(0,l.useState)("group"===a.type?a.name:""),[u,x]=(0,l.useState)("group"===a.type?a.description:""),[h,p]=(0,l.useState)(!1),f=async()=>{if(d.trim()&&"group"===a.type){p(!0);try{let e=await fetch("/api/chat-groups/".concat(a.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:d,description:u})});if(e.ok){let t=await e.json();o(t),s(!1)}}catch(e){console.error("Failed to update group settings:",e)}finally{p(!1)}}};return"group"!==a.type?null:(0,r.jsx)(j.Vq,{open:t,onOpenChange:s,children:(0,r.jsxs)(j.cZ,{className:"sm:max-w-md",children:[(0,r.jsx)(j.fK,{children:(0,r.jsxs)(j.$N,{className:"flex items-center",children:[(0,r.jsx)(G.Z,{className:"w-5 h-5 mr-2"}),"Group Settings"]})}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"Group Name"}),(0,r.jsx)(i.I,{placeholder:"Enter group name...",value:d,onChange:e=>m(e.target.value),disabled:!c})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"Description"}),(0,r.jsx)(w.g,{placeholder:"Enter group description...",value:u,onChange:e=>x(e.target.value),rows:3,disabled:!c})]}),!c&&(0,r.jsx)("div",{className:"text-sm text-gray-500 bg-gray-50 p-3 rounded",children:"Only group administrators can edit these settings."}),c&&(0,r.jsxs)("div",{className:"flex justify-end space-x-2 pt-4 border-t",children:[(0,r.jsx)(n.zx,{variant:"outline",onClick:()=>s(!1),children:"Cancel"}),(0,r.jsxs)(n.zx,{onClick:f,disabled:!d.trim()||h,children:[h?(0,r.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}):null,"Update"]})]})]})]})})}function K(e){let{open:t,onOpenChange:s,chat:a,currentUser:o,onChatUpdate:c}=e,[d,m]=(0,l.useState)("direct"===a.type?a.user_one===o?a.name_one:a.name_two:""),[u,x]=(0,l.useState)("direct"===a.type?a.user_one===o?a.name_two:a.name_one:""),[h,p]=(0,l.useState)(!1),f=async()=>{if(d.trim()&&u.trim()&&"direct"===a.type){p(!0);try{let e=await fetch("/api/chats/".concat(a.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name_one:a.user_one===o?d:u,name_two:a.user_one===o?u:d})});if(e.ok){let t=await e.json();c(t),s(!1)}}catch(e){console.error("Failed to update names:",e)}finally{p(!1)}}};return"direct"!==a.type?null:(0,r.jsx)(j.Vq,{open:t,onOpenChange:s,children:(0,r.jsxs)(j.cZ,{className:"sm:max-w-md",children:[(0,r.jsx)(j.fK,{children:(0,r.jsxs)(j.$N,{className:"flex items-center",children:[(0,r.jsx)(M.Z,{className:"w-5 h-5 mr-2"}),"Edit Contact Names"]})}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"Your Name"}),(0,r.jsx)(i.I,{placeholder:"Enter your display name...",value:d,onChange:e=>m(e.target.value)})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"Name"}),(0,r.jsx)(i.I,{placeholder:"Enter friend's display name...",value:u,onChange:e=>x(e.target.value)})]}),(0,r.jsx)("div",{className:"text-sm text-gray-500 bg-gray-50 p-3 rounded",children:"These names are only visible to you and help you identify your contacts."}),(0,r.jsxs)("div",{className:"flex justify-end space-x-2 pt-4 border-t",children:[(0,r.jsx)(n.zx,{variant:"outline",onClick:()=>s(!1),children:"Cancel"}),(0,r.jsxs)(n.zx,{onClick:f,disabled:!d.trim()||!u.trim()||h,children:[h?(0,r.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}):null,"Update Names"]})]})]})]})})}var Q=s(79587),$=s(68680);let B=()=>a=(0,$.io)("https://api.sparking.cloud",{withCredentials:!0,transports:["websocket","polling"]}),J=()=>{if(!a)throw Error("Socket chưa được khởi tạo!");return a};var X=s(58970),ee=s(66789),et=s(9334),es=s(33388),ea=s(84428),er=s(61649),el=s(22106),en=s(71947),ei=s(48736),eo=s(92735);function ec(e){let{link:t,content:s,className:a=""}=e,l=e=>{try{let t=e.split("/");return(null!=s?s:t[t.length-1]).split("?")[0]||"attachment"}catch(e){return"attachment"}},n=(e,t)=>{switch(e){case"archive":return{icon:et.Z,color:"text-orange-600",bgColor:"bg-orange-100",label:"Archive File",description:".RAR"===t?"WinRAR Archive":"Compressed Archive"};case"executable":return{icon:".APK"===t?es.Z:ea.Z,color:"text-red-600",bgColor:"bg-red-100",label:"Executable File",description:".APK"===t?"Android App":"Software Package"};case"document":return{icon:er.Z,color:"text-green-600",bgColor:"bg-green-100",label:"Document",description:"Document File"};case"audio":return{icon:el.Z,color:"text-purple-600",bgColor:"bg-purple-100",label:"Audio File",description:"Music/Audio"};case"code":return{icon:en.Z,color:"text-indigo-600",bgColor:"bg-indigo-100",label:"Code File",description:"Source Code"};default:return{icon:ei.Z,color:"text-blue-600",bgColor:"bg-blue-100",label:"File",description:"Unknown File Type"}}},i=(e=>{let t=[".jpg",".jpeg",".png",".gif",".webp",".svg",".bmp",".ico",".tiff"],s=[".mp4",".webm",".ogg",".avi",".mov",".wmv",".flv",".mkv",".m4v",".3gp"],a=e.toLowerCase();if(e.includes("cloudinary.com")){if(e.includes("/image/")||t.some(e=>a.includes(e)))return"image";if(e.includes("/video/")||s.some(e=>a.includes(e)))return"video"}return t.some(e=>a.endsWith(e))?"image":s.some(e=>a.endsWith(e))?"video":[".rar",".zip",".7z",".tar",".gz",".bz2",".xz",".tar.gz",".tar.bz2"].some(e=>a.endsWith(e))?"archive":[".exe",".msi",".dmg",".pkg",".deb",".rpm",".appimage",".apk"].some(e=>a.endsWith(e))?"executable":[".pdf",".doc",".docx",".xls",".xlsx",".ppt",".pptx",".txt",".rtf"].some(e=>a.endsWith(e))?"document":[".mp3",".wav",".flac",".aac",".ogg",".wma",".m4a"].some(e=>a.endsWith(e))?"audio":[".js",".ts",".jsx",".tsx",".html",".css",".py",".java",".cpp",".c",".php",".rb",".go",".rs"].some(e=>a.endsWith(e))?"code":"file"})(t),o=null!=s?s:l(t),c=(e=>{let t=(null!=s?s:l(e)).split(".");return t.length>1?".".concat(t[t.length-1].toUpperCase()):""})(t);return t?(0,r.jsx)("div",{className:a,children:(()=>{switch(i){case"image":return(0,r.jsx)("div",{className:"mt-2 max-w-xs",children:(0,r.jsx)(ee.Z,{src:t||"/placeholder.svg",alt:"Attachment",className:"max-w-full h-auto max-h-48 object-contain cursor-pointer hover:opacity-90 transition-opacity rounded-lg overflow-hidden border border-gray-200"})});case"video":return(0,r.jsx)("div",{className:"mt-2 rounded-lg overflow-hidden border border-gray-200 max-w-xs",children:(0,r.jsx)("div",{className:"relative bg-black",children:(0,r.jsxs)("video",{controls:!0,className:"w-full max-h-48 object-contain",preload:"metadata",children:[(0,r.jsx)("source",{src:t,type:"video/mp4"}),"Your browser does not support the video tag."]})})});case"audio":return(0,r.jsx)("div",{className:"mt-2 rounded-lg border border-gray-200 max-w-xs bg-white",children:(0,r.jsxs)("audio",{controls:!0,className:"w-full",children:[(0,r.jsx)("source",{src:t}),"Your browser does not support the audio tag."]})});default:let e=n(i,c),s=e.icon;return(0,r.jsxs)("div",{className:"mt-2 p-3 bg-white rounded-lg border border-gray-200 max-w-xs",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"p-2 ".concat(e.bgColor," rounded-lg flex-shrink-0"),children:(0,r.jsx)(s,{size:20,className:e.color})}),(0,r.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,r.jsx)("div",{className:"font-medium text-gray-900 text-sm truncate",children:o}),c&&(0,r.jsx)("span",{className:"px-1.5 py-0.5 ".concat(e.bgColor," ").concat(e.color," text-xs font-medium rounded"),children:c})]}),(0,r.jsx)("div",{className:"text-xs text-gray-500 mb-2",children:e.description}),(0,r.jsxs)("a",{href:t,download:o,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 px-3 py-1.5 bg-blue-600 text-white rounded text-xs hover:bg-blue-700 transition-colors",children:[(0,r.jsx)(eo.Z,{size:12}),"Tải về"]})]})]}),"executable"===i&&(0,r.jsx)("div",{className:"mt-2 p-2 bg-yellow-50 border border-yellow-200 rounded text-xs",children:(0,r.jsxs)("div",{className:"flex items-center gap-1 text-yellow-800",children:[(0,r.jsx)("span",{className:"font-medium",children:"⚠️ Cảnh b\xe1o:"}),(0,r.jsx)("span",{children:"H\xe3y cẩn thận khi chạy file thực thi từ nguồn kh\xf4ng r\xf5"})]})}),".RAR"===c&&(0,r.jsx)("div",{className:"mt-2 p-2 bg-blue-50 border border-blue-200 rounded text-xs",children:(0,r.jsxs)("div",{className:"text-blue-800",children:[(0,r.jsx)("span",{className:"font-medium",children:"\uD83D\uDCA1 Gợi \xfd:"}),(0,r.jsx)("span",{className:"ml-1",children:"Cần WinRAR hoặc 7-Zip để giải n\xe9n"})]})})]})}})()}):null}function ed(e){var t;let{chat:s,currentUser:a,users:d,onChatUpdate:m}=e,[u,x]=(0,l.useState)([]),h=(0,l.useRef)(null),[p,g]=(0,l.useState)(""),[v,j]=(0,l.useState)(""),[y,b]=(0,l.useState)(""),[w,C]=(0,l.useState)(!1),[_,k]=(0,l.useState)(!1),[Z,S]=(0,l.useState)(!1),[z,U]=(0,l.useState)(!1),I=(0,l.useRef)(null);(0,l.useEffect)(()=>{h.current||(h.current=B());let e=h.current;return e.emit("join_me"),e.on("load_delete_chat",e=>{x(t=>t.filter(t=>t.id!==e.data))}),e.on("load_chat",e=>{x(t=>[...t,e.data])}),()=>{e.off("load_chat"),e.disconnect()}},[]),(0,l.useEffect)(()=>{P(),s.id&&h.current&&(console.log(s.id),h.current.emit("join_chat",{chat:s.id}))},[s.id]),(0,l.useEffect)(()=>{es()},[u]);let P=async()=>{try{let e="direct"===s.type?await N.Z.getContentChats(s.id):await N.Z.getContentGroupChats(s.id);(null==e?void 0:e.statusCode)===200&&x(null==e?void 0:e.data)}catch(e){console.error("Failed to fetch messages:",e)}},$=async e=>{if(e.preventDefault(),p.trim()&&!w){C(!0);try{let e=J(),r={content:p,user:a,chat:s.id},l={content:p,user:a,chat_group:s.id},n="direct"===s.type?await N.Z.createContentChats((0,Q.Z)(r)):await N.Z.createContentGroupChats((0,Q.Z)(l));if(201===n.statusCode){if("direct"===s.type&&e.emit("notify_new_message",{chat:s.id,user:s.user_two,data:n.data}),"group"===s.type){var t;e.emit("notify_new_message_group",{chat_group:s.id,head:s.head,members:null===(t=s.members)||void 0===t?void 0:t.map(e=>e.user),data:n.data})}g("")}}catch(e){console.error("Failed to send message:",e)}finally{C(!1)}}},ee=async()=>{try{let t=J(),a="direct"===s.type?await N.Z.deleteContent([v]):await N.Z.deleteContentGroup([v]);if(200===a.statusCode&&("direct"===s.type&&t.emit("notify_delete_message",{chat:s.id,user:s.user_two,data:v}),"group"===s.type)){var e;t.emit("notify_delete_message_group",{chat_group:s.id,head:s.head,members:null===(e=s.members)||void 0===e?void 0:e.map(e=>e.user),data:v})}j("")}catch(e){console.error("Failed to delete message:",e)}},et=async()=>{let e=J();if("group"===s.type)try{let r=s.head===a,l=r?await N.Z.deleteChatGroup([y]):await N.Z.deleteMemberChatGroup(y);if((null==l?void 0:l.statusCode)===200){var t;r?e.emit("notify_delete_chat_group",{chat_group:s.id,head:s.head,members:null===(t=s.members)||void 0===t?void 0:t.map(e=>e.user)}):e.emit("notify_leave_chat_group",{chat_group:s.id})}b("")}catch(e){console.error("Failed to leave/delete group:",e)}},es=()=>{var e;null===(e=I.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},ea=()=>"direct"===s.type?s.user_one===a?s.name_two:s.name_one:s.name,er=e=>{let t=new Date(e),s=new Date,a=String(t.getUTCHours()).padStart(2,"0"),r=String(t.getUTCMinutes()).padStart(2,"0");if(t.getUTCDate()!==s.getUTCDate()||t.getUTCMonth()!==s.getUTCMonth()||t.getUTCFullYear()!==s.getUTCFullYear()){let e=String(t.getUTCDate()).padStart(2,"0"),s=String(t.getUTCMonth()+1).padStart(2,"0"),l=t.getUTCFullYear();return"".concat(e,"-").concat(s,"-").concat(l," ").concat(a,":").concat(r)}return"".concat(a,":").concat(r)},el=e=>{let t=new Date,s=new Date(e);if(s.toDateString()===t.toDateString())return"Today";let a=new Date(t);return(a.setDate(a.getDate()-1),s.toDateString()===a.toDateString())?"Yesterday":s.toLocaleDateString("en-US",{month:"short",day:"numeric"})},en="group"===s.type&&s.head===a,ei=(0,l.useRef)(null),eo=async e=>{var t,r;let l=null===(t=e.target.files)||void 0===t?void 0:t[0];if(l)try{let e=J(),t={link:l,content:l.name,user:a,chat:s.id},n={link:l,user:a,content:l.name,chat_group:s.id},i="direct"===s.type?await N.Z.createContentChats((0,Q.Z)(t)):await N.Z.createContentGroupChats((0,Q.Z)(n));201===i.statusCode&&("direct"===s.type&&e.emit("notify_new_message",{chat:s.id,user:s.user_two,data:i.data}),"group"===s.type&&e.emit("notify_new_message_group",{chat_group:s.id,head:s.head,members:null===(r=s.members)||void 0===r?void 0:r.map(e=>e.user),data:i.data}),g(""))}catch(e){console.error("Failed to send message:",e)}finally{C(!1)}};return(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border-b bg-white",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(c.qE,{className:"w-10 h-10 mr-3",children:(0,r.jsx)(c.Q5,{children:ea().split(" ").map(e=>e[0]).join("").toUpperCase()})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"font-semibold",children:ea()}),"group"===s.type&&(0,r.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,r.jsx)(f.Z,{className:"w-4 h-4 mr-1"}),(null==s?void 0:null===(t=s.members)||void 0===t?void 0:t.length)||0," members"]})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:["group"===s.type&&(0,r.jsx)(o.C,{variant:"secondary",children:"Group"}),(0,r.jsxs)(D,{children:[(0,r.jsx)(T,{asChild:!0,children:(0,r.jsx)(n.zx,{variant:"ghost",size:"sm",children:(0,r.jsx)(A.Z,{className:"w-4 h-4"})})}),(0,r.jsx)(F,{align:"end",children:"direct"===s.type?(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(R,{onClick:()=>U(!0),children:[(0,r.jsx)(M.Z,{className:"w-4 h-4 mr-2"}),"Edit Names"]})}):(0,r.jsxs)(r.Fragment,{children:[en&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(R,{onClick:()=>k(!0),children:[(0,r.jsx)(G.Z,{className:"w-4 h-4 mr-2"}),"Group Settings"]}),(0,r.jsxs)(R,{onClick:()=>S(!0),children:[(0,r.jsx)(O.Z,{className:"w-4 h-4 mr-2"}),"Manage Members"]}),(0,r.jsx)(E,{}),(0,r.jsxs)(R,{onClick:()=>b(s.id),className:"text-red-600",children:[(0,r.jsx)(V.Z,{className:"w-4 h-4 mr-2"}),"Delete Group"]})]}),!en&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(R,{onClick:()=>S(!0),children:[(0,r.jsx)(f.Z,{className:"w-4 h-4 mr-2"}),"View Members"]}),(0,r.jsx)(E,{}),(0,r.jsxs)(R,{onClick:()=>b(s.id),className:"text-red-600",children:[(0,r.jsx)(Y.Z,{className:"w-4 h-4 mr-2"}),"Leave Group"]})]})]})})]})]})]}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50",children:[0===u.length?(0,r.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,r.jsxs)("div",{className:"text-center text-gray-500",children:[(0,r.jsx)("p",{className:"text-lg font-medium",children:"No messages yet"}),(0,r.jsx)("p",{className:"text-sm",children:"Start the conversation!"})]})}):u.map((e,t)=>{var l,n,i,o,c,m,x,h,p,f,g,v;let N=0===t||el(e.created_at)!==el(u[t-1].created_at);return(0,r.jsxs)("div",{children:[N&&(0,r.jsx)("div",{className:"flex justify-center mb-4",children:(0,r.jsx)("span",{className:"bg-white px-3 py-1 rounded-full text-xs text-gray-600 shadow-sm",children:el(e.created_at)})}),(0,r.jsx)("div",{className:"flex ".concat(e.user===a?"justify-end":"justify-start"),children:(0,r.jsxs)("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-lg ".concat(e.user===a?"bg-blue-500 text-white rounded-br-sm":"bg-white text-gray-800 shadow-sm rounded-bl-sm"),children:["group"===s.type&&e.user!==a&&(0,r.jsx)("div",{className:"flex justify-between",children:(0,r.jsx)("div",{className:"text-xs font-medium mb-1 opacity-70 flex items-center",children:null!==(f=null!==(p=null===(n=s.members)||void 0===n?void 0:null===(l=n.find(t=>t.user===e.user))||void 0===l?void 0:l.name)&&void 0!==p?p:(null==d?void 0:null===(i=d.find(t=>t.user_id===e.user))||void 0===i?void 0:i.first_name)+" "+(null==d?void 0:null===(o=d.find(t=>t.user_id===e.user))||void 0===o?void 0:o.last_name))&&void 0!==f?f:"ADMIN"})}),"group"===s.type&&e.user===a&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("div",{className:"text-xs font-medium mb-1 opacity-70 flex items-center",children:null!==(v=null!==(g=null===(m=s.members)||void 0===m?void 0:null===(c=m.find(t=>t.user===e.user))||void 0===c?void 0:c.name)&&void 0!==g?g:(null==d?void 0:null===(x=d.find(t=>t.user_id===e.user))||void 0===x?void 0:x.first_name)+" "+(null==d?void 0:null===(h=d.find(t=>t.user_id===e.user))||void 0===h?void 0:h.last_name))&&void 0!==v?v:"ADMIN"}),(0,r.jsx)(V.Z,{className:"ml-2 cursor-pointer w-4 h-4",onClick:()=>j(e.id)})]}),"group"!==s.type&&e.user===a&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("div",{className:"text-xs font-medium mb-1 opacity-70 flex items-center",children:e.user===s.user_one?s.name_one:s.name_two}),(0,r.jsx)(V.Z,{className:"ml-2 cursor-pointer w-4 h-4",onClick:()=>j(e.id)})]}),"group"!==s.type&&e.user!==a&&(0,r.jsx)("div",{className:"text-xs font-medium mb-1 opacity-70",children:e.user===s.user_one?s.name_one:s.name_two}),!e.link&&(0,r.jsx)("div",{className:"break-words",children:e.content}),e.link&&(0,r.jsx)(ec,{content:e.content,link:e.link}),(0,r.jsx)("div",{className:"text-xs mt-1 ".concat(e.user===a?"text-blue-100":"text-gray-500"),children:er(e.created_at)})]})})]},e.id)}),(0,r.jsx)("div",{ref:I})]}),(0,r.jsx)("div",{className:"p-4 bg-white border-t",children:(0,r.jsxs)("form",{onSubmit:$,className:"flex items-center space-x-2",children:[(0,r.jsx)(n.zx,{type:"button",variant:"ghost",size:"sm",onClick:()=>{var e;null===(e=ei.current)||void 0===e||e.click()},children:(0,r.jsx)(L.Z,{className:"w-4 h-4"})}),(0,r.jsx)("input",{type:"file",ref:ei,className:"hidden",onChange:eo}),(0,r.jsx)(i.I,{value:p,onChange:e=>g(e.target.value),placeholder:"Type a message...",className:"flex-1",disabled:w}),(0,r.jsx)(n.zx,{type:"submit",disabled:w||!p.trim(),children:(0,r.jsx)(q.Z,{className:"w-4 h-4"})})]})}),"group"===s.type&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(H,{open:_,onOpenChange:k,chat:s,onChatUpdate:m,isHead:en}),(0,r.jsx)(W,{open:Z,onOpenChange:S,chat:s,users:d,currentUser:a,onChatUpdate:m,isHead:en})]}),"direct"===s.type&&(0,r.jsx)(K,{open:z,onOpenChange:U,chat:s,currentUser:a,onChatUpdate:m}),(0,r.jsx)(X.Z,{open:""!==v,title:"X\xf3a dữ liệu",onOk:ee,onCancel:()=>{j("")},children:"Bạn c\xf3 chắc chắn muốn x\xf3a kh\xf4ng ?"}),(0,r.jsx)(X.Z,{open:""!==y,title:"group"===s.type?s.head===a?"X\xf3a nh\xf3m chat":"Rời nh\xf3m chat":"Rời nh\xf3m ch\xe1t",onOk:et,onCancel:()=>{b("")},children:"Bạn c\xf3 chắc chắn muốn x\xf3a kh\xf4ng ?"})]})}var em=s(79820),eu=s(68575);function ex(){let{projectID:e}=(0,y.useParams)(),[t,s]=(0,l.useState)(null),[a,n]=(0,l.useState)([]),[i,o]=(0,l.useState)([]),{datas:c}=(0,eu.v9)(e=>e.get_profile);(0,l.useEffect)(()=>{m(),d();let e=B();return e.emit("join_me"),e.on("load_list_chat",()=>{console.log("keui n"),m()}),e.on("load_delete_chat_group",e=>{x(null==e?void 0:e.data)}),()=>{e.disconnect()}},[]);let d=async()=>{try{let t=await N.Z.getUsersByProject(e);200===t.statusCode&&o(t.data)}catch(e){console.error("Failed to fetch users:",e)}},m=async()=>{try{var t,s;let a=await N.Z.getChats(e),r=await N.Z.getChatGroups(e);n(null==a?void 0:null===(s=a.data)||void 0===s?void 0:s.map(e=>({...e,type:"direct"})).concat(null==r?void 0:null===(t=r.data)||void 0===t?void 0:t.map(e=>({...e,type:"group"}))))}catch(e){console.error("Failed to fetch chats:",e)}},u=e=>{n(t=>t.map(t=>t.id===e.id?e:t)),(null==t?void 0:t.id)===e.id&&s(e)},x=e=>{n(t=>t.filter(t=>t.id!==e)),(null==t?void 0:t.id)===e&&s(null)};return(0,r.jsxs)("div",{className:"flex h-[calc(100vh-64px)] bg-gray-100",children:[(0,r.jsx)("div",{className:"w-96 border-r bg-white",children:(0,r.jsx)(k,{chats:a,users:i,selectedChat:t,onSelectChat:s,onNewChat:e=>{let t=J();if("direct"===e.type&&t.emit("notify_new_chat",{user:e.user_two}),"group"===e.type){var a;t.emit("notify_new_chat_group",{user:null===(a=e.members)||void 0===a?void 0:a.map(e=>e.user)})}n(t=>[e,...t]),s(e)},onChatUpdate:u,onChatDelete:x,currentUser:null==c?void 0:c.user_id})}),(0,r.jsx)("div",{className:"flex-1",children:t?(0,r.jsx)(ed,{chat:t,currentUser:null==c?void 0:c.user_id,users:i,onChatUpdate:u}):(0,r.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,r.jsxs)(em.Zb,{className:"p-8 text-center",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Welcome to Chat"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Select a conversation to start chatting"})]})})})]})}},96246:function(e,t,s){s.d(t,{F$:function(){return o},Q5:function(){return c},qE:function(){return i}});var a=s(57437),r=s(2265),l=s(61146),n=s(93448);let i=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.fC,{ref:t,className:(0,n.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...r})});i.displayName=l.fC.displayName;let o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.Ee,{ref:t,className:(0,n.cn)("aspect-square h-full w-full",s),...r})});o.displayName=l.Ee.displayName;let c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.NY,{ref:t,className:(0,n.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...r})});c.displayName=l.NY.displayName},74291:function(e,t,s){s.d(t,{$N:function(){return h},Be:function(){return p},Vq:function(){return o},cN:function(){return x},cZ:function(){return m},fK:function(){return u}});var a=s(57437),r=s(2265),l=s(49027),n=s(32489),i=s(93448);let o=l.fC;l.xz;let c=l.h_;l.x8;let d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.aV,{ref:t,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r})});d.displayName=l.aV.displayName;let m=r.forwardRef((e,t)=>{let{className:s,children:r,...o}=e;return(0,a.jsxs)(c,{children:[(0,a.jsx)(d,{}),(0,a.jsxs)(l.VY,{ref:t,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...o,children:[r,(0,a.jsxs)(l.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(n.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});m.displayName=l.VY.displayName;let u=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})};u.displayName="DialogHeader";let x=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s})};x.displayName="DialogFooter";let h=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.Dx,{ref:t,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",s),...r})});h.displayName=l.Dx.displayName;let p=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.dk,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",s),...r})});p.displayName=l.dk.displayName},40279:function(e,t,s){s.d(t,{I:function(){return n}});var a=s(57437),r=s(2265),l=s(93448);let n=r.forwardRef((e,t)=>{let{className:s,type:r,...n}=e;return(0,a.jsx)("input",{type:r,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...n})});n.displayName="Input"},23675:function(e,t,s){s.d(t,{g:function(){return n}});var a=s(57437),r=s(2265),l=s(93448);let n=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("textarea",{className:(0,l.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...r})});n.displayName="Textarea"}}]);