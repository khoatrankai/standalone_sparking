(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8444],{30531:function(e,t,l){"use strict";l.d(t,{Z:function(){return J}});var a=l(57437),r=l(2265),i=l(91626),n=l(3810),o=l(11632),d=l(58970),c=l(91250),s=l(56771),u=l(68575),p=l(12),h=l(97853),g=l.n(h),m=l(46475);l(94062);var v=l(64439),f=l(16836),x=l(90136),y=l(42654),C=l(44967),w=l(23496),j=l(56612),b=l(29487),_=l(45747),N=l(7140),Z=l(22744),F=l(17166),T=l(71096),k=l.n(T);function S(e){let{ID:t}=e,l=(0,r.useRef)(),[n,s]=(0,r.useState)(!1),{datas:p}=(0,u.v9)(e=>e.vat_system),{datas:h}=(0,u.v9)(e=>e.get_projects),{datas:g}=(0,u.v9)(e=>e.infos_customer),{datas:T}=(0,u.v9)(e=>e.info_products),{datas:S}=(0,u.v9)(e=>e.unit_product),{datas:A}=(0,u.v9)(e=>e.get_profits),{datas:E}=(0,u.v9)(e=>e.type_package),[I,P]=(0,r.useState)(0),[D,B]=(0,r.useState)("percent"),[z,W]=(0,r.useState)("none"),[q,O]=(0,r.useState)(0),[L,V]=(0,r.useState)([]),[U,M]=(0,r.useState)(0),[R,G]=(0,r.useState)(0),J=(0,a.jsxs)(o.Z,{defaultValue:"percent",onChange:e=>{B(e)},children:[(0,a.jsx)(_.W,{value:"percent",children:"%"}),(0,a.jsx)(_.W,{value:"money",children:"vnđ"})]}),Y=e=>[{title:"Loại sản phẩm",dataIndex:["type","name"],key:"type",render:(t,l,r)=>(0,a.jsxs)("div",{className:"flex gap-1 items-center",children:[l.name&&(0,a.jsx)(Z.KVB,{className:"cursor-pointer text-lg",onClick:()=>{ee(e,r)}}),t]})},{title:"T\xean sản phẩm",dataIndex:"name",key:"name"},{title:"M\xf4 tả",dataIndex:"description",key:"description",render:(t,l,r)=>l.name?(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("p",{children:(null==t?void 0:t.length)>20?"".concat(t.slice(0,20),"..."):t})}):(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(f.default.TextArea,{placeholder:"M\xf4 tả chi tiết",value:t,onChange:t=>{V(a=>a.map((a,i)=>i===e?{...a,products:a.products.map((e,a)=>{if(a===(null==l?void 0:l.ikey)){var i;return{...e,children:null===(i=e.children)||void 0===i?void 0:i.map((e,l)=>l===r?{...e,description:t.target.value}:e)}}return e})}:a))},autoSize:{minRows:1}})})},{title:"Đơn vị",dataIndex:"unit",key:"unit",width:"100px",render:(t,l,r)=>{if(l.name){var i;return(0,a.jsx)(a.Fragment,{children:null==l?void 0:null===(i=l.unit_product)||void 0===i?void 0:i.name_unit})}return(0,a.jsx)(o.Z,{placeholder:"Chọn đơn vị",showSearch:!0,value:t,onChange:t=>{V(a=>a.map((a,i)=>i===e?{...a,products:a.products.map((e,a)=>{if(a===(null==l?void 0:l.ikey)){var i;return{...e,children:null===(i=e.children)||void 0===i?void 0:i.map((e,l)=>l===r?{...e,unit:t}:e)}}return e})}:a))},filterOption:(e,t)=>{var l,a;return(null!==(a=null==t?void 0:null===(l=t.children)||void 0===l?void 0:l.join(""))&&void 0!==a?a:"").toLowerCase().includes(e.toLowerCase())},children:null==S?void 0:S.map(e=>(0,a.jsx)(_.W,{value:e.unit_id,children:e.name_unit},e.unit_id))})}},{title:"Số lượng",dataIndex:"quantity",key:"quantity",width:"30px",render:(t,l,r)=>l.name?(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(x.Z,{onChange:t=>{V(l=>l.map((l,a)=>a===e?{...l,products:l.products.map((e,l)=>l===r?{...e,quantity:t}:e)}:l))},min:1,value:t})}):(0,a.jsx)(x.Z,{min:1,value:t,onChange:t=>{V(a=>a.map((a,i)=>i===e?{...a,products:a.products.map((e,a)=>{if(a===(null==l?void 0:l.ikey)){var i;return{...e,children:null===(i=e.children)||void 0===i?void 0:i.map((e,l)=>l===r?{...e,quantity:null!=t?t:1}:e)}}return e})}:a))}})},{title:"Gi\xe1 sản phẩm (VNĐ)",dataIndex:"price",key:"price",width:"120px",render:(t,l,r)=>(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(x.Z,{placeholder:"Gi\xe1",onChange:t=>{l.name?V(l=>l.map((l,a)=>a===e?{...l,products:l.products.map((e,l)=>l===r?{...e,price:t}:e)}:l)):V(a=>a.map((a,i)=>i===e?{...a,products:a.products.map((e,a)=>{if(a===(null==l?void 0:l.ikey)){var i;return{...e,children:null===(i=e.children)||void 0===i?void 0:i.map((e,l)=>l===r?{...e,price:null!=t?t:1}:e)}}return e})}:a))},className:"w-full",value:t,formatter:e=>"".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>null==e?void 0:e.replace(/\$\s?|(,*)/g,"")})})},{title:"Thuế VAT",dataIndex:"vat",key:"vat",width:"30px",render:(t,l,r)=>{if(l.name)return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(o.Z,{placeholder:"Chọn loại thuế",showSearch:!0,defaultValue:t,onChange:t=>{V(l=>l.map((l,a)=>a===e?{...l,products:l.products.map((e,l)=>l===r?{...e,vat:t}:e)}:l))},filterOption:(e,t)=>{var l,a;return(null!==(a=null==t?void 0:null===(l=t.children)||void 0===l?void 0:l.join(""))&&void 0!==a?a:"").toLowerCase().includes(e.toLowerCase())},children:null==p?void 0:p.map(e=>(0,a.jsxs)(_.W,{value:e.vat_id,children:[e.type_vat,"%"]},e.vat_id))})})}},{title:"Lợi nhuận",dataIndex:"profit",key:"profit",width:"30px",render:(t,l,r)=>{if(l.name)return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(o.Z,{placeholder:"Chọn loại thuế",showSearch:!0,defaultValue:t,onChange:t=>{V(l=>l.map((l,a)=>a===e?{...l,products:l.products.map((e,l)=>l===r?{...e,profit:t}:e)}:l))},filterOption:(e,t)=>{var l,a;return(null!==(a=null==t?void 0:null===(l=t.children)||void 0===l?void 0:l.join(""))&&void 0!==a?a:"").toLowerCase().includes(e.toLowerCase())},children:null==A?void 0:A.map(e=>(0,a.jsxs)(_.W,{value:e.profit_id,children:[e.type_profit,"%"]},e.profit_id))})})}},{title:"",dataIndex:"",key:"",render:(t,l,r)=>(0,a.jsx)("div",{className:"flex gap-2 items-center",children:(0,a.jsx)(i.ZP,{type:"primary",onClick:()=>{l.name?V(t=>t.map((t,l)=>l===e?{...t,products:t.products.filter((e,t)=>t!==r)}:t)):V(t=>t.map((t,a)=>a===e?{...t,products:t.products.map((e,t)=>{if(t===(null==l?void 0:l.ikey)){var a;return{...e,children:null===(a=e.children)||void 0===a?void 0:a.filter((e,t)=>t!==r)}}return e})}:t))},className:"bg-red-500",icon:(0,a.jsx)(Z.ZkW,{})})})}],[H]=(0,b.Z)(),{postdata:Q}=(0,m.Z)(),{datas:X}=(0,u.v9)(e=>e.get_users),[K,$]=(0,r.useState)(!1),ee=(e,t)=>{V(l=>l.map((l,a)=>a===e?{...l,products:l.products.map((l,a)=>a===t?{...l,key:a,children:l.children?[...l.children,{ikey:t,key:1e4*e+1e3*a+l.children.length+100,description:"",unit:"",quantity:1,price:0}]:[{ikey:t,key:1e4*e+1e3*a+100,description:"",unit:"",quantity:1,price:0}]}:l)}:l))},et=async e=>{let l=await Q(()=>v.Z.updatePriceQuote(t,{...e,parts:L.map(e=>({title:e.title,products:e.products.map(e=>({product:e.product_id,price:e.price,quantity:e.quantity,vat:e.vat,profit:e.profit,list_detail:e.children})),type_package:e.type_package}))}));(200===l||201===l)&&$(!1)},el=async()=>{let e=await v.Z.getPriceQuoteID(t);200===e.statusCode&&(e.data.opportunity&&s(!0),V(e.data.parts.map((e,t)=>{var l,a;return{...e,products:e.products.map((e,l)=>({...e,children:e.list_detail.map((e,a)=>({...e,ikey:l,key:1e4*t+1e3*l+a+100})),key:l})),type_package:null!==(a=null==e?void 0:null===(l=e.type_package)||void 0===l?void 0:l.package_id)&&void 0!==a?a:""}})),H.setFieldsValue({...e.data}))};(0,r.useEffect)(()=>{if(L){let e=L.map(e=>e.products).flat(),t=e.reduce((e,t)=>{var l,a;let r=t.price*t.quantity*((null!==(a=null===(l=A.find(e=>e.profit_id===t.profit))||void 0===l?void 0:l.type_profit)&&void 0!==a?a:0)/100);return t.price*t.quantity+r+e},0);if(O(t),"before"===z){let l="percent"===D?e.reduce((e,t)=>{var l,a;let r=t.price*t.quantity*((null!==(a=null===(l=A.find(e=>e.profit_id===t.profit))||void 0===l?void 0:l.type_profit)&&void 0!==a?a:0)/100);return(t.price*t.quantity+r)*I/100+e},0):I;G("percent"===D?e.reduce((e,t)=>{var l,a,r,i;let n=t.price*t.quantity*((null!==(r=null===(l=A.find(e=>e.profit_id===t.profit))||void 0===l?void 0:l.type_profit)&&void 0!==r?r:0)/100);return(t.price*t.quantity+n-(t.price*t.quantity+n)*I/100)*(null!==(i=null==p?void 0:null===(a=p.find(e=>e.vat_id===t.vat))||void 0===a?void 0:a.type_vat)&&void 0!==i?i:0)/100+e},0):e.reduce((e,l)=>{var a,r,i,n;let o=l.price*l.quantity*((null!==(i=null===(a=A.find(e=>e.profit_id===l.profit))||void 0===a?void 0:a.type_profit)&&void 0!==i?i:0)/100);return(l.price*l.quantity+o-(l.price*l.quantity+o)/t*I)*(null!==(n=null==p?void 0:null===(r=p.find(e=>e.vat_id===l.vat))||void 0===r?void 0:r.type_vat)&&void 0!==n?n:0)/100+e},0)),M(l)}else{let t=e.reduce((e,t)=>{var l,a,r,i;let n=t.price*t.quantity*((null!==(r=null===(l=A.find(e=>e.profit_id===t.profit))||void 0===l?void 0:l.type_profit)&&void 0!==r?r:0)/100);return(t.price*t.quantity+n)*(null!==(i=null==p?void 0:null===(a=p.find(e=>e.vat_id===t.vat))||void 0===a?void 0:a.type_vat)&&void 0!==i?i:0)/100+e},0),l="percent"===D?e.reduce((e,t)=>{var l,a,r,i;let n=t.price*t.quantity*((null!==(r=null===(l=A.find(e=>e.profit_id===t.profit))||void 0===l?void 0:l.type_profit)&&void 0!==r?r:0)/100);return(t.price*t.quantity+n-(t.price*t.quantity+n)*(null!==(i=null==p?void 0:null===(a=p.find(e=>e.vat_id===t.vat))||void 0===a?void 0:a.type_vat)&&void 0!==i?i:0)/100)*I/100+e},0):I;G(t),M(l)}}},[L,D,z,I]);let ea=async(e,t)=>{t&&V(l=>l.map((l,a)=>a===e?l.products.find(e=>e.product_id===t.product_id)?{...l,products:l.products.map(e=>e.product_id===t.product_id?{...e,quantity:e.quantity+1}:e)}:{...l,products:[...l.products,{...t,quantity:1}]}:l))},er=async()=>{V(e=>[...e,{title:"",products:[],type_package:""}])},ei=async(e,t)=>{V(l=>l.map((l,a)=>a===e?{...l,type_package:t}:l))},en=async()=>{H.submit()},eo=async(e,t)=>{V(l=>l.map((l,a)=>a===e?{...l,title:t}:l))};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.ZP,{className:"  text-xs text-yellow-500 font-semibold",type:"text",onClick:()=>{$(!0),el()},children:"Chỉnh sửa"}),(0,a.jsxs)(d.Z,{title:"Cập nhật b\xe1o gi\xe1",open:K,onCancel:()=>{$(!1)},footer:null,width:"100%",style:{maxWidth:"1000px"},children:[(0,a.jsxs)(y.Z,{defaultActiveKey:"1",style:{width:"100%"},type:"line",children:[(0,a.jsx)(N.Z,{tab:"Th\xf4ng tin b\xe1o gi\xe1",children:(0,a.jsxs)(C.Z,{layout:"vertical",form:H,onFinish:et,style:{display:"flex",flexWrap:"wrap",columnGap:"12px"},children:[n?(0,a.jsx)(C.Z.Item,{name:"customer",label:"Kh\xe1ch h\xe0ng",style:{minWidth:"240px",flex:"1 1 0%"},children:(0,a.jsx)(o.Z,{disabled:!0,filterOption:(e,t)=>{var l;return(Array.isArray(null==t?void 0:t.children)?t.children.join(""):null!==(l=null==t?void 0:t.children)&&void 0!==l?l:"").toLowerCase().includes(e.toLowerCase())},children:null==g?void 0:g.map(e=>(0,a.jsx)(_.W,{value:e.info_id,children:e.name_company},e.info_id))})}):(0,a.jsx)(C.Z.Item,{name:"project",label:"Dự \xe1n b\xe1o gi\xe1",rules:[{required:!0,message:"Vui l\xf2ng chọn dự \xe1n!"}],style:{minWidth:"240px",flex:"1 1 0%"},children:(0,a.jsx)(o.Z,{placeholder:"Chọn dự \xe1n",showSearch:!0,filterOption:(e,t)=>{var l;return(Array.isArray(null==t?void 0:t.children)?t.children.join(""):null!==(l=null==t?void 0:t.children)&&void 0!==l?l:"").toLowerCase().includes(e.toLowerCase())},dropdownRender:e=>(0,a.jsxs)(a.Fragment,{children:[e,(0,a.jsx)(w.Z,{style:{margin:"8px 0"}}),(0,a.jsx)(i.ZP,{type:"link",onClick:()=>{var e;null===(e=l.current)||void 0===e||e.click()},children:"+ Th\xeam t\xf9y chọn mới"})]}),children:null==h?void 0:h.map(e=>(0,a.jsx)(_.W,{value:e.project_id,children:e.name},e.project_id))})}),(0,a.jsx)(C.Z.Item,{name:"reference_code",label:"M\xe3 tham chiếu",style:{minWidth:"240px",flex:"1 1 0%"},children:(0,a.jsx)(f.default,{})}),(0,a.jsx)(C.Z.Item,{name:"type_vat",label:"Loại thuế",style:{minWidth:"240px",flex:"1 1 0%"},children:(0,a.jsxs)(o.Z,{placeholder:"Select discount type",defaultValue:"none",onChange:e=>{W(e)},children:[(0,a.jsx)(_.W,{value:"none",children:"None"}),(0,a.jsx)(_.W,{value:"before",children:"Before"}),(0,a.jsx)(_.W,{value:"after",children:"After"})]})}),(0,a.jsx)(C.Z.Item,{name:"type_money",label:"Đơn vị tiền",style:{minWidth:"240px",flex:"1 1 0%"},children:(0,a.jsxs)(o.Z,{placeholder:"Select a currency type",children:[(0,a.jsx)(_.W,{value:"vnd",children:"VND"}),(0,a.jsx)(_.W,{value:"usd",children:"USD"})]})}),(0,a.jsx)(C.Z.Item,{name:"user_support",label:"Người phụ tr\xe1ch",style:{minWidth:"240px",flex:"1 1 0%"},children:(0,a.jsx)(o.Z,{placeholder:"Chọn nh\xe2n vi\xean",showSearch:!0,filterOption:(e,t)=>{var l;return(Array.isArray(null==t?void 0:t.children)?t.children.join(""):null!==(l=null==t?void 0:t.children)&&void 0!==l?l:"").toLowerCase().includes(e.toLowerCase())},children:null==X?void 0:X.map(e=>(0,a.jsxs)(_.W,{value:e.user_id,children:[e.first_name," ",e.last_name]},e.user_id))})}),(0,a.jsx)(C.Z.Item,{name:"status",label:"Trạng th\xe1i",rules:[{required:!0}],style:{minWidth:"240px",flex:"1 1 0%"},children:(0,a.jsxs)(o.Z,{placeholder:"Select status",children:[(0,a.jsx)(_.W,{value:"draff",children:"Draff"}),(0,a.jsx)(_.W,{value:"send",children:"Send"}),(0,a.jsx)(_.W,{value:"open",children:"Open"}),(0,a.jsx)(_.W,{value:"edit",children:"Edit"}),(0,a.jsx)(_.W,{value:"refuse",children:"Refuse"}),(0,a.jsx)(_.W,{value:"accept",children:"Accept"})]})}),(0,a.jsx)(C.Z.Item,{name:"date_start",label:"Ng\xe0y bắt đầu",initialValue:"",className:" mb-0",style:{minWidth:"320px",flex:"1 1 0%"},getValueFromEvent:e=>null==e?void 0:e.format("YYYY-MM-DD"),getValueProps:e=>({value:e?k()(e):""}),children:(0,a.jsx)(j.default,{placeholder:"Chọn ng\xe0y bắt đầu",style:{width:"100%"}})}),(0,a.jsx)(C.Z.Item,{name:"date_expired",label:"Ng\xe0y kết th\xfac",rules:[{required:!0}],initialValue:"",className:" mb-0",style:{minWidth:"320px",flex:"1 1 0%"},getValueFromEvent:e=>null==e?void 0:e.format("YYYY-MM-DD"),getValueProps:e=>({value:e?k()(e):""}),children:(0,a.jsx)(j.default,{placeholder:"Chọn ng\xe0y kết th\xfac",style:{width:"100%"}})})]})},1),(0,a.jsxs)(N.Z,{tab:"Th\xf4ng tin sản phẩm",children:[(0,a.jsx)(i.ZP,{type:"primary",className:"mb-4",onClick:er,children:"Th\xeam th\xe0nh phần"}),L.length>0&&(0,a.jsx)("div",{className:"flex gap-2 flex-col p-2 bg-[#00A9AE] rounded-sm",children:L.map((e,t)=>(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(o.Z,{placeholder:"Chọn sản phẩm cần th\xeam",showSearch:!0,className:"min-w-56",onSelect:e=>{ea(t,T.find(t=>t.product_id===e))},filterOption:(e,t)=>{var l,a;return(null!==(a=null==t?void 0:null===(l=t.children)||void 0===l?void 0:l.join(""))&&void 0!==a?a:"").toLowerCase().includes(e.toLowerCase())},children:null==T?void 0:T.map(e=>(0,a.jsx)(_.W,{value:e.product_id,children:e.name},e.product_id))}),(0,a.jsxs)("div",{className:"flex gap-2",children:[L.length>1&&(0,a.jsx)(f.default,{defaultValue:e.title,onChange:e=>{eo(t,e.target.value)},placeholder:"Nhập t\xean ti\xeau đề"}),(0,a.jsx)(o.Z,{placeholder:"Chọn g\xf3i",showSearch:!0,allowClear:!0,className:"min-w-56",defaultValue:e.type_package,onSelect:e=>{ei(t,e)},onClear:()=>{ei(t,void 0)},filterOption:(e,t)=>{var l,a;return(null!==(a=null==t?void 0:null===(l=t.children)||void 0===l?void 0:l.join(""))&&void 0!==a?a:"").toLowerCase().includes(e.toLowerCase())},children:null==E?void 0:E.map(e=>(0,a.jsx)(_.W,{value:e.package_id,children:e.name_package},e.package_id))})]})]}),(0,a.jsx)("div",{className:" w-full overflow-x-auto",children:(0,a.jsx)("div",{className:"min-w-fit custom-table-wrapper",children:(0,a.jsx)(c.Z,{columns:Y(t),showHeader:0===t,footer:()=>{let e=L[t].products.reduce((e,t)=>{var l,a;let r=t.price*t.quantity*((null!==(a=null===(l=A.find(e=>e.profit_id===t.profit))||void 0===l?void 0:l.type_profit)&&void 0!==a?a:0)/100);return t.price*t.quantity+r+e},0);return(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("strong",{children:"Gi\xe1 trị:"})," ",e.toLocaleString("vi-VN")," VNĐ"]})},dataSource:e.products,pagination:{pageSize:10,showTotal:(e,t)=>"".concat(t[0],"-").concat(t[1]," of ").concat(e," items")},scroll:{x:"max-content",y:200},showSorterTooltip:{target:"sorter-icon"}})})})]})}))})]},2)]}),(0,a.jsxs)("div",{className:"flex flex-col items-end gap-2 p-2 w-full bg-slate-100 rounded-sm",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("p",{className:"w-80 flex justify-end",children:"Tổng:"}),(0,a.jsxs)("span",{className:"min-w-32 flex justify-end",children:[Math.round(q).toLocaleString("vi-VN"),"đ"]})]}),(0,a.jsx)("div",{children:(0,a.jsxs)("div",{className:"flex items-center justify-end",children:[(0,a.jsxs)("div",{className:"w-80 flex items-center justify-end gap-2",children:["Chiết khấu"," ",(0,a.jsx)("div",{className:"w-60",children:(0,a.jsx)(x.Z,{addonAfter:J,defaultValue:0,onChange:e=>{P(null!=e?e:0)}})})]}),(0,a.jsxs)("span",{className:"min-w-32 flex justify-end",children:["-",U.toLocaleString("vi-VN"),"đ"]})]})}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("p",{className:"w-80 flex justify-end",children:"Thuế:"}),(0,a.jsxs)("span",{className:"min-w-32 flex justify-end",children:[Math.round(R).toLocaleString("vi-VN"),"đ"]})]}),(0,a.jsxs)("div",{className:"flex items-center text-xl text-red-500",children:[(0,a.jsx)("p",{className:"w-80 flex justify-end",children:"Th\xe0nh tiền:"}),(0,a.jsxs)("span",{className:"min-w-32 flex justify-end",children:[Math.round(q-U+R).toLocaleString("vi-VN"),"đ"]})]})]}),(0,a.jsx)("div",{className:"flex justify-end w-full mt-4",children:(0,a.jsx)(i.ZP,{type:"primary",onClick:en,children:"Cập nhật"})})]}),(0,a.jsx)(F.Z,{refBtnProject:l})]})}var A=l(18528),E=l(99376),I=l(65624),P=l(82957).lW;function D(){let e=(0,I.Z)(["admin-top","price_quote","price_quote-edit"]),{customerID:t}=(0,E.useParams)(),[l,h]=(0,r.useState)(25),{datas:f}=(0,u.v9)(e=>e.get_price_quotes),{datas:x}=(0,u.v9)(e=>e.unit_product);(0,r.useEffect)(()=>{t&&F((0,A.j)({customer:t}))},[t]);let y=async e=>{var t,l,a,r,i,n,o,d,c,s,u,h,m,v,f,y,C,w,j,b,_,N,Z,F,T,k,S,A,E,I,D,B,z,W,q,O,L,V,U,M,R,G,J;let Y=(e,t,l)=>{let a=e.split("\n");return l*(a.length+a.reduce((e,l)=>Math.ceil(l.length/t)-1+e,0))*100/80},H=e.parts.map(e=>({title:e.title,list:e.products.map(e=>({name:e.name,description:e.description,refresh_code:e.code_original,brand:e.brand.name+" "+e.original.name,unit:e.unit_product.name_unit,quantity:e.quantity,profit:e.profit.type_profit,price:e.price,list_detail:e.list_detail})),type:!!e.products.find(e=>e.list_detail.length>0)})),Q=new(g()).Workbook,X=Q.addWorksheet("Sheet 1"),K=await fetch("/image/header.png").then(e=>e.arrayBuffer()),$=[{title:"Điều khoản thương mại chung",list:["Địa điểm giao h\xe0ng: Gi\xe1 tr\xean được hiểu l\xe0 gi\xe1 giao h\xe0ng đến c\xf4ng tr\xecnh","Thiết bị cung cấp v\xe0 thi c\xf4ng, lắp đặt l\xe0 h\xe0ng h\xf3a mới 100%","Bảng gi\xe1 n\xe0y c\xf3 gi\xe1 trị 30 ng\xe0y kể từ ng\xe0y b\xe1o gi\xe1","Thời hạn thực hiện: Trong v\xf2ng 4-6 tuần kể từ ng\xe0y k\xfd hợp đồng hoặc b\xe1o gi\xe1 c\xf3 hiệu lực"]}];console.log("qua roi");let ee=P.from(K),et=Q.addImage({buffer:ee,extension:"png"});X.addImage(et,{tl:{col:1,row:0},ext:{width:1021,height:120}});let el=[{index:10,height:22.8},{index:11,height:20.4},{index:14,height:20.1},{index:15,height:20.1},{index:16,height:20.1},{index:17,height:20.1},{index:18,height:20.1},{index:19,height:20.1},{index:24,height:59.1}];X.mergeCells("B10:J10"),X.getCell("B10").alignment={horizontal:"center",vertical:"middle",wrapText:!0},X.mergeCells("B11:J11"),X.getCell("B11").alignment={horizontal:"center",vertical:"middle",wrapText:!0};for(let e=0;e<el.length;e++)X.getRow(el[e].index).height=100*el[e].height/80;X.getCell("B10").value={richText:[{text:null!==(A=null==e?void 0:null===(t=e.project)||void 0===t?void 0:t.name)&&void 0!==A?A:"",font:{bold:!0,size:18,name:"Arial"}}]},X.getCell("B11").value={richText:[{text:"Option 2: Entrance and Exit controlled by manpower (Parking Toll: BOOTH)",font:{bold:!1,size:16,color:{argb:"FF0000"},name:"Arial"}}]},X.getCell("B14").value={richText:[{text:"K\xednh gửi/To: ",font:{bold:!1}},{text:null!==(I=null!==(E=null==e?void 0:null===(a=e.project)||void 0===a?void 0:null===(l=a.customer)||void 0===l?void 0:l.name_company.toUpperCase())&&void 0!==E?E:null==e?void 0:null===(r=e.customer)||void 0===r?void 0:r.name_company.toUpperCase())&&void 0!==I?I:"",font:{bold:!0}}]},X.getCell("B15").value={richText:[{text:"Địa chỉ/Address: ",font:{bold:!1}},{text:null!==(W=null!==(z=(null!==(B=null!==(D=null==e?void 0:null===(n=e.project)||void 0===n?void 0:null===(i=n.customer)||void 0===i?void 0:i.address_delivery)&&void 0!==D?D:null==e?void 0:null===(o=e.customer)||void 0===o?void 0:o.address_delivery)&&void 0!==B?B:","+(null==e?void 0:null===(s=e.project)||void 0===s?void 0:null===(c=s.customer)||void 0===c?void 0:null===(d=c.province_delivery)||void 0===d?void 0:d.name_province)).toUpperCase())&&void 0!==z?z:null==e?void 0:null===(h=e.customer)||void 0===h?void 0:null===(u=h.province_delivery)||void 0===u?void 0:u.name_province.toUpperCase())&&void 0!==W?W:"",font:{bold:!0}}]},X.getCell("B16").value={richText:[{text:"Người nhận/Receiver: ",font:{bold:!1}},{text:null!==(O=null!==(q=null==e?void 0:null===(f=e.project)||void 0===f?void 0:null===(v=f.customer)||void 0===v?void 0:null===(m=v.name_company)||void 0===m?void 0:m.toUpperCase())&&void 0!==q?q:null==e?void 0:null===(C=e.customer)||void 0===C?void 0:null===(y=C.name_company)||void 0===y?void 0:y.toUpperCase())&&void 0!==O?O:"",font:{bold:!0}}]},X.getCell("B17").value={richText:[{text:"Tel: ",font:{bold:!1}},{text:null!==(V=null!==(L=null==e?void 0:null===(b=e.project)||void 0===b?void 0:null===(j=b.customer)||void 0===j?void 0:null===(w=j.phone_number)||void 0===w?void 0:w.toUpperCase())&&void 0!==L?L:null==e?void 0:null===(N=e.customer)||void 0===N?void 0:null===(_=N.phone_number)||void 0===_?void 0:_.toUpperCase())&&void 0!==V?V:"",font:{bold:!0}}]},X.getCell("B18").value={richText:[{text:"Email: ",font:{bold:!1}},{text:null!==(M=null!==(U=null==e?void 0:null===(F=e.project)||void 0===F?void 0:null===(Z=F.customer)||void 0===Z?void 0:Z.phone_number)&&void 0!==U?U:null==e?void 0:null===(T=e.customer)||void 0===T?void 0:T.phone_number)&&void 0!==M?M:"",font:{bold:!0}}]},X.getCell("G14").value={richText:[{text:"Số b\xe1o gi\xe1/Quotation: ",font:{bold:!1}},{text:e.price_quote_id.toUpperCase(),font:{bold:!0}}]},X.getCell("G15").value={richText:[{text:"Ng\xe0y b\xe1o gi\xe1/Date: ",font:{bold:!1}},{text:null!==(R=new Date(e.created_at).toLocaleDateString("vi-VN"))&&void 0!==R?R:"N/A",font:{bold:!0}}]},X.getCell("G16").value={richText:[{text:"Người b\xe1o gi\xe1/ Quoted by: ",font:{bold:!1}},{text:(null!==(J=null!==(G=null===(k=e.user_support)||void 0===k?void 0:k.first_name)&&void 0!==G?G:" "+(null===(S=e.user_support)||void 0===S?void 0:S.last_name))&&void 0!==J?J:"").toUpperCase(),font:{bold:!0}}]},X.getCell("G17").value={richText:[{text:"Phone: ",font:{bold:!1}},{text:"+84.906.862.780",font:{bold:!0}}]},X.getCell("G18").value={richText:[{text:"Email: ",font:{bold:!1}},{text:"contact@sparking.com.vn",font:{bold:!0}}]},X.getCell("B24").value={richText:[{text:"STT\n",font:{bold:!0,name:"Arial",size:12}},{text:"No.",font:{bold:!1,name:"Arial",size:12}}]},X.getCell("C24").value={richText:[{text:"M\xf4 tả\n",font:{bold:!0,name:"Arial",size:12}},{text:"Description",font:{bold:!1,name:"Arial",size:12}}]},X.getCell("D24").value={richText:[{text:"Diễn giải\n",font:{bold:!0,name:"Arial",size:12}},{text:"Note",font:{bold:!1,name:"Arial",size:12}}]},X.getCell("E24").value={richText:[{text:"M\xe3 hiệu\n",font:{bold:!0,name:"Arial",size:12}},{text:"Code",font:{bold:!1,name:"Arial",size:12}}]},X.getCell("F24").value={richText:[{text:"Thương hiệu/ Xuất xứ\n",font:{bold:!0,name:"Arial",size:12}},{text:"Brand/ Original",font:{bold:!1,name:"Arial",size:12}}]},X.getCell("G24").value={richText:[{text:"ĐVT\n",font:{bold:!0,name:"Arial",size:12}},{text:"Unit",font:{bold:!1,name:"Arial",size:12}}]},X.getCell("H24").value={richText:[{text:"Số lượng\n",font:{bold:!0,name:"Arial",size:12}},{text:"Qty.",font:{bold:!1,name:"Arial",size:12}}]},X.getCell("I24").value={richText:[{text:"Đơn gi\xe1\n",font:{bold:!0,name:"Arial",size:12}},{text:"Unit Price\n",font:{bold:!1,name:"Arial",size:12}},{text:"(VND)",font:{bold:!1,name:"Arial",size:12}}]},X.getCell("J24").value={richText:[{text:"Th\xe0nh tiền\n",font:{bold:!0,name:"Arial",size:12}},{text:"Amount Price",font:{bold:!1,name:"Arial",size:12}}]},X.getCell("M24").value={richText:[{text:"MUA",font:{bold:!0}}]},X.getCell("M24").border={top:{style:"dashed"},left:{style:"dashed"},bottom:{style:"dashed"},right:{style:"dashed"}},X.getCell("N24").value={richText:[{text:"TỶ LỆ",font:{bold:!0}}]},X.getCell("N24").border={top:{style:"dashed"},left:{style:"dashed"},bottom:{style:"dashed"},right:{style:"dashed"}},X.getCell("O24").value={richText:[{text:"TỔNG MUA",font:{bold:!0,color:{argb:"FF0000"}}}]},X.getCell("O24").fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFCC"}},X.getCell("O24").border={top:{style:"dashed"},left:{style:"dashed"},bottom:{style:"dashed"},right:{style:"dashed"}},X.getCell("P24").value={richText:[{text:"B\xc1N",font:{bold:!0}}]},X.getCell("P24").border={top:{style:"dashed"},left:{style:"dashed"},bottom:{style:"dashed"},right:{style:"dashed"}},(()=>{let e=25,t=1,l=[];H.forEach(a=>{l.push(e),X.getCell("B".concat(e)).value={richText:[{text:"".concat(a.title.toUpperCase()),font:{bold:!0,color:{argb:"FF0000"}}}]};for(let t=2;t<=16;t++)X.getCell(e,t).alignment={vertical:"middle"};X.getRow(e).height=43.875,X.getCell("J".concat(e)).value={formula:"SUBTOTAL(9,J".concat(e+1,":J").concat(a.list.length+e,")"),result:0},X.getCell("J".concat(e)).font={color:{argb:"FF0000"},bold:!0},X.getCell(e,10).numFmt="#,##0",X.getCell("M".concat(e)).fill={type:"pattern",pattern:"solid",fgColor:{argb:"F2F2F2"}},X.getCell("O".concat(e)).value={formula:"SUBTOTAL(9,O".concat(e+1,":O").concat(a.list.length+a.list.reduce((e,t)=>(null==t?void 0:t.list_detail.length)>0?t.list_detail.length+e:e,0)+e,")"),result:0},X.getCell("O".concat(e)).font={bold:!0},X.getCell(e,15).numFmt="#,##0",X.getCell("O".concat(e)).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFCC"}},X.getCell("P".concat(e)).numFmt="0%",X.getCell("P".concat(e)).value={formula:"(J".concat(e,"-O").concat(e,")/J").concat(e),result:0},X.getCell("P".concat(e)).font={color:{argb:"FF0000"},bold:!0},X.getCell("P".concat(e)).fill={type:"pattern",pattern:"solid",fgColor:{argb:"CAEDFB"}},X.getCell("J".concat(e)).border={right:{style:"thin"}};for(let t=1;t<=11;t++)X.getCell(e,t).fill={type:"pattern",pattern:"solid",fgColor:{argb:"CAEDFB"}};for(let t=13;t<17;t++)X.getCell(e,t).border={top:{style:"dashed"},left:{style:"dashed"},bottom:{style:"dashed"},right:{style:"dashed"}};X.getCell("B".concat(e)).border={left:{style:"thin"}},e++,a.type?a.list.forEach((t,l)=>{X.getRow(e).height=Y(t.description,30,18),X.getCell(e,2).value=l+1,X.getCell(e,2).alignment={vertical:"middle",horizontal:"center",wrapText:!0};for(let t=2;t<11;t++)X.getCell(e,t).border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}};X.getCell(e,3).value=t.name,X.getCell(e,3).alignment={vertical:"middle",wrapText:!0},X.getCell(e,4).value=t.description,X.getCell(e,4).alignment={vertical:"middle",wrapText:!0},X.getCell(e,5).value=t.refresh_code,X.getCell(e,5).alignment={vertical:"middle",horizontal:"center",wrapText:!0},X.getCell(e,6).value=t.brand,X.getCell(e,6).alignment={vertical:"middle",horizontal:"center",wrapText:!0},X.getCell(e,7).value=t.unit,X.getCell(e,7).alignment={vertical:"middle",horizontal:"center",wrapText:!0},X.getCell(e,8).value=t.quantity,X.getCell(e,8).alignment={vertical:"middle",horizontal:"center",wrapText:!0},X.getCell(e,9).value={formula:"ROUNDUP(P".concat(e,",-4)")},X.getCell(e,9).alignment={vertical:"middle",horizontal:"right",wrapText:!0},X.getCell(e,9).numFmt="#,##0",X.getCell(e,10).numFmt="#,##0",X.getCell(e,15).numFmt="#,##0",X.getCell(e,16).numFmt="#,##0",X.getCell(e,10).value={formula:"H".concat(e,"*I").concat(e)},X.getCell(e,10).alignment={vertical:"middle",horizontal:"right",wrapText:!0},X.getCell(e,13).value={formula:"O".concat(e)},X.getCell(e,13).numFmt="#,##0",X.getCell(e,13).alignment={vertical:"middle",horizontal:"center",wrapText:!0},X.getCell(e,13).font={color:{argb:"FF0000"}},X.getCell(e,13).fill={type:"pattern",pattern:"solid",fgColor:{argb:"F2F2F2"}},X.getCell(e,14).value=t.profit/100,X.getCell(e,14).numFmt="0%",X.getCell(e,14).alignment={vertical:"middle",horizontal:"right",wrapText:!0},X.getCell(e,15).value={formula:"SUBTOTAL(9,O".concat(e+1,":O").concat(t.list_detail.length+e,")")},X.getCell(e,15).font={bold:!0},X.getCell(e,15).alignment={vertical:"middle",horizontal:"right",wrapText:!0},X.getCell(e,15).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFCC"}},X.getCell(e,16).value={formula:"M".concat(e,"*N").concat(e,"+M").concat(e)},X.getCell(e,16).alignment={vertical:"middle",horizontal:"right",wrapText:!0};for(let t=13;t<17;t++)X.getCell(e,t).border={top:{style:"dashed"},left:{style:"dashed"},bottom:{style:"dashed"},right:{style:"dashed"}};e++,t.list_detail.forEach(t=>{var l;let a=null===(l=x.find(e=>e.unit_id===t.unit))||void 0===l?void 0:l.name_unit;X.getCell(e,2).border={left:{style:"thin"},top:{style:"dashed"},bottom:{style:"dashed"},right:{style:"dashed"}},X.getCell(e,10).border={left:{style:"dashed"},top:{style:"dashed"},bottom:{style:"dashed"},right:{style:"thin"}};for(let t=3;t<10;t++)X.getCell(e,t).border={top:{style:"dashed"},left:{style:"dashed"},bottom:{style:"dashed"},right:{style:"dashed"}};X.getCell(e,4).value=t.description,X.getCell(e,4).alignment={vertical:"middle",wrapText:!0},X.getCell(e,7).alignment={vertical:"middle",horizontal:"center",wrapText:!0},X.getCell(e,8).value=t.quantity,X.getCell(e,8).alignment={vertical:"middle",horizontal:"center",wrapText:!0},X.getCell(e,13).value=t.price,X.getCell(e,13).numFmt="#,##0",X.getCell(e,13).alignment={vertical:"middle",horizontal:"center",wrapText:!0},X.getCell(e,13).fill={type:"pattern",pattern:"solid",fgColor:{argb:"F2F2F2"}},isNaN(Number(a))?(X.getCell(e,7).value=a,X.getCell(e,15).value={formula:"M".concat(e,"*H").concat(e)}):(X.getCell(e,7).value=Number(a),X.getCell(e,15).value={formula:"M".concat(e,"/G").concat(e,"*H").concat(e)}),X.getCell(e,15).alignment={vertical:"middle",horizontal:"right",wrapText:!0},X.getCell(e,15).numFmt="#,##0",X.getCell(e,15).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFCC"}};for(let t=13;t<17;t++)X.getCell(e,t).border={top:{style:"dashed"},left:{style:"dashed"},bottom:{style:"dashed"},right:{style:"dashed"}};e++})}):a.list.forEach(l=>{X.getRow(e).height=Y(l.description,30,18),X.getCell(e,2).value=t++,X.getCell(e,2).alignment={vertical:"middle",horizontal:"center",wrapText:!0};for(let t=2;t<11;t++)X.getCell(e,t).border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}};X.getCell(e,3).value=l.name,X.getCell(e,3).alignment={vertical:"middle",wrapText:!0},X.getCell(e,4).value=l.description,X.getCell(e,4).alignment={vertical:"middle",wrapText:!0},X.getCell(e,5).value=l.refresh_code,X.getCell(e,5).alignment={vertical:"middle",horizontal:"center",wrapText:!0},X.getCell(e,6).value=l.brand,X.getCell(e,6).alignment={vertical:"middle",horizontal:"center",wrapText:!0},X.getCell(e,7).value=l.unit,X.getCell(e,7).alignment={vertical:"middle",horizontal:"center",wrapText:!0},X.getCell(e,8).value=l.quantity,X.getCell(e,8).alignment={vertical:"middle",horizontal:"center",wrapText:!0},X.getCell(e,9).value={formula:"ROUNDUP(P".concat(e,",-4)")},X.getCell(e,9).alignment={vertical:"middle",horizontal:"right",wrapText:!0},X.getCell(e,9).numFmt="#,##0",X.getCell(e,10).numFmt="#,##0",X.getCell(e,15).numFmt="#,##0",X.getCell(e,16).numFmt="#,##0",X.getCell(e,10).value={formula:"H".concat(e,"*I").concat(e)},X.getCell(e,10).alignment={vertical:"middle",horizontal:"right",wrapText:!0},X.getCell(e,13).value=l.price,X.getCell(e,13).numFmt="#,##0",X.getCell(e,13).alignment={vertical:"middle",horizontal:"center",wrapText:!0},X.getCell(e,13).font={color:{argb:"FF0000"}},X.getCell(e,13).fill={type:"pattern",pattern:"solid",fgColor:{argb:"F2F2F2"}},X.getCell(e,14).value=l.profit/100,X.getCell(e,14).numFmt="0%",X.getCell(e,14).alignment={vertical:"middle",horizontal:"right",wrapText:!0},X.getCell(e,15).value={formula:"M".concat(e,"*H").concat(e)},X.getCell(e,15).alignment={vertical:"middle",horizontal:"right",wrapText:!0},X.getCell(e,15).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFCC"}},X.getCell(e,16).value={formula:"M".concat(e,"*N").concat(e,"+M").concat(e)},X.getCell(e,16).alignment={vertical:"middle",horizontal:"right",wrapText:!0};for(let t=13;t<17;t++)X.getCell(e,t).border={top:{style:"dashed"},left:{style:"dashed"},bottom:{style:"dashed"},right:{style:"dashed"}};e++})});for(let t=3;t<=10;t++)X.getCell(e,t).fill={type:"pattern",pattern:"solid",fgColor:{argb:"61CBF3"}},t>3&&t<10&&(X.getCell(e+4,t).fill={type:"pattern",pattern:"solid",fgColor:{argb:"D9D9D9"}});for(let t=13;t<=16;t++)(15===t||16===t)&&(X.getCell(e,t).fill={type:"pattern",pattern:"solid",fgColor:{argb:"61CBF3"}}),X.getCell(e,t).border={top:{style:"dashed"},left:{style:"dashed"},bottom:{style:"dashed"},right:{style:"dashed"}};X.getCell(e,8).value={richText:[{text:"Amount before VAT",font:{bold:!0}}]},X.getRow(e).height=60.625,X.getCell(e,10).value={formula:"SUBTOTAL(9,J25:J".concat(e-1,")")},X.getCell(e,10).numFmt="#,##0",X.getCell(e,10).font={bold:!0},X.getCell(e,15).value={formula:"SUBTOTAL(9,O25:O".concat(e-1,")")},X.getCell(e,15).numFmt="#,##0",X.getCell(e,15).font={bold:!0},X.getRow(e).eachCell(e=>{e.alignment||(e.alignment={}),e.alignment.vertical="middle"}),X.getCell(e+1,15).value={formula:"J".concat(e,"-O").concat(e)},X.getCell(e+1,15).numFmt="#,##0",X.getCell(e+2,15).value={formula:"O".concat(e+1,"/J").concat(e)},X.getCell(e+2,15).numFmt="0%",X.getCell(e+4,4).value={richText:[{text:"SUMARY",font:{color:{argb:"FF0000"}}}]},l.forEach((t,l)=>{X.getCell(e+4+1+l,4).value={richText:[{text:H[l].title,font:{bold:!0}}]},X.getCell(e+4+1+l,9).value={formula:"J".concat(t)},X.getCell(e+4+1+l,9).numFmt="#,##0"});let a=e+8+l.length;$.forEach(e=>{X.getCell(a,2).value={richText:[{text:e.title+":",font:{bold:!0}}]},a++,e.list.forEach(e=>{X.getCell(a,3).value={richText:[{text:e,font:{bold:!1}}]},a++})})})();for(let e=13;e<=19;e++)for(let t=1;t<=11;t++)X.getCell(e,t).fill={type:"pattern",pattern:"solid",fgColor:{argb:"F2F2F2"}};let ea=[2.4,5.2,21.1,47.1,18.9,15.9,10.6,9.9,14.5,15.9,2.7,2.6,13.4,7.3,16.8,15.9];for(let e=1;e<=16;e++)if(X.getColumn(e).width=100*ea[e-1]/98,e>12&&(X.getCell(24,e).alignment={vertical:"middle",horizontal:"center",wrapText:!0}),e<12){let t=X.getCell(24,e);e>1&&e<11&&(t.alignment={vertical:"middle",horizontal:"center",wrapText:!0},t.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}),t.fill={type:"pattern",pattern:"solid",fgColor:{argb:"D9D9D9"}}}X.eachRow({includeEmpty:!0},e=>{e.eachCell(e=>{e.font||(e.font={}),e.font.name="Arial",e.font.size=12})});try{let t=await Q.xlsx.writeBuffer(),l=new Blob([t],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});(0,p.saveAs)(l,e.price_quote_id+".xlsx")}catch(e){console.log(e)}},[C,w]=(0,r.useState)([]),j=[{title:"B\xe1o gi\xe1#",className:"text-xs",dataIndex:"price_quote_id",render:(t,l,r)=>(0,a.jsxs)("div",{className:"flex flex-col gap-1 ",children:[(0,a.jsxs)("strong",{children:["#",r+1,"."]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(i.ZP,{type:"text",ghost:!0,className:"text-xs text-blue-600",onClick:()=>{_(t)},children:"Xuất"}),e&&(0,a.jsx)(S,{ID:t})]})]}),sorter:(e,t)=>e.price_quote_id.localeCompare(t.price_quote_id)},{title:"Dự \xe1n",className:"text-xs",dataIndex:["project","name"],sorter:(e,t)=>{var l,a;return(null!==(l=e.project.name)&&void 0!==l?l:"").localeCompare(null!==(a=t.project.name)&&void 0!==a?a:"")},render:e=>"".concat(e)},{title:"Ng\xe0y b\xe1o gi\xe1",className:"text-xs",dataIndex:"date_start",render:e=>e?new Date(e).toLocaleDateString("vi-VN"):"N/A",sorter:(e,t)=>e.date_start.toString().localeCompare(t.date_start.toString())},{title:"Ng\xe0y hết hạn",className:"text-xs",dataIndex:"date_expired",render:e=>e?new Date(e).toLocaleDateString("vi-VN"):"N/A",sorter:(e,t)=>e.date_expired.toString().localeCompare(t.date_expired.toString())},{title:"M\xe3 tham chiếu",className:"text-xs",dataIndex:"reference_code",sorter:(e,t)=>e.reference_code.localeCompare(t.reference_code)},{title:"T\xecnh trạng",className:"text-xs",dataIndex:"status",render:e=>(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(n.Z,{color:"draff"===e?"gray":"send"===e?"lightblue":"open"===e?"blue":"edit"===e?"yellow":"refuse"===e?"red":"accept"===e?"green":"",children:[e.charAt(0).toUpperCase()+e.slice(1)," "]})}),sorter:(e,t)=>e.status.localeCompare(t.status)}],b=e=>{w(null==f?void 0:f.filter(t=>String(t.created_at+" "+t.date_expired+" "+t.date_start+" "+t.project.name+" "+t.price_quote_id+" "+t.user_support.last_name+" "+t.status).toLowerCase().includes(e.toLowerCase())))},_=async e=>{let t=await v.Z.getExportPriceQuote(e);200===t.statusCode&&await y(t.data)},{postdata:N}=(0,m.Z)(),F=(0,u.I0)(),[T,k]=(0,r.useState)(!1),[D,B]=(0,r.useState)([]),z=async()=>{200===await N(()=>v.Z.deletePriceQuotes(D))&&(F((0,A.j)({customer:t})),B([]),k(!1))},W=(0,E.useSearchParams)();return(0,r.useEffect)(()=>{let e=W.get("id");f&&e?b(e):w(f.map((e,t)=>({...e,key:t})))},[f,W]),(0,a.jsxs)("div",{className:"",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2 flex-wrap gap-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(o.Z,{defaultValue:l,style:{width:83},onChange:e=>h(e),options:[{value:10,label:10},{value:25,label:25},{value:50,label:50},{value:100,label:100},{value:500,label:500},{value:1e3,label:1e3},{value:1e8,label:"Tất cả"}]}),(0,a.jsx)(i.ZP,{hidden:!(D.length>0),children:"Xuất ra"}),(0,a.jsx)(i.ZP,{onClick:()=>{k(!0)},danger:!0,hidden:!(D.length>0),className:"text-xl",icon:(0,a.jsx)(Z.FH3,{})}),(0,a.jsx)(d.Z,{open:T,title:"X\xf3a dữ liệu",onOk:z,onCancel:()=>{k(!1)},children:"Bạn c\xf3 chắc chắn muốn x\xf3a kh\xf4ng ?"})]}),(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)(s.Z,{onChange:e=>{b(e.target.value)},placeholder:"T\xecm kiếm",style:{width:200}})})]}),(0,a.jsx)("div",{className:"w-full overflow-auto",children:(0,a.jsx)("div",{className:"min-w-fit",children:(0,a.jsx)(c.Z,{columns:j,rowSelection:{onChange:(e,t)=>{B(t.map(e=>{var t;return null!==(t=e.price_quote_id)&&void 0!==t?t:""}))}},dataSource:C,scroll:{x:"max-content"},pagination:{pageSize:l,showTotal:(e,t)=>"".concat(t[0],"-").concat(t[1]," of ").concat(e," items")},showSorterTooltip:{target:"sorter-icon"}})})})]})}var B=l(16532),z=l(27648),W=l(45202),q=l(94295),O=l(67776),L=l(32768),V=l(49089),U=l(32479),M=e=>{let{refBtnTypePackage:t}=e,[l,n]=(0,r.useState)(!1),[o,s]=(0,r.useState)([]),p=(0,u.I0)(),{datas:h}=(0,u.v9)(e=>e.type_package),g=async(e,t,l)=>{try{let a=await _(()=>v.Z.updateTypePackage(t,e));200===a&&(p((0,U.v)()),y(l))}catch(e){console.error("Error creating unit :",e)}},x=e=>{s([...o,e])},y=e=>{s(o.filter(t=>t!==e))},[w,j]=(0,r.useState)(!1),{postdata:_}=(0,m.Z)(),[N]=(0,b.Z)(),[Z,F]=(0,r.useState)(""),T=async()=>{200===await _(()=>v.Z.deleteTypePackage([null!=Z?Z:""]))&&(p((0,U.v)()),F(""))},k=[{title:"M\xe3 g\xf3i",dataIndex:"package_id",key:"package_id",render:(e,t,l)=>(0,a.jsxs)("div",{className:"flex gap-1 items-center",children:["#",l+1,".",e]})},{title:"Loại g\xf3i",dataIndex:"name_package",width:"50%",key:"name_package",render:(e,t,l)=>(0,a.jsx)(a.Fragment,{children:o.includes(l)?(0,a.jsxs)(C.Z,{onFinish:e=>{g(e.name,t.package_id,l)},style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:[(0,a.jsx)(C.Z.Item,{name:"name",rules:[{required:!0,message:"Vui l\xf2ng nhập t\xean g\xf3i"}],style:{margin:"0"},children:(0,a.jsx)(f.default,{placeholder:"Nhập t\xean g\xf3i",defaultValue:e})}),(0,a.jsxs)(C.Z.Item,{style:{gap:"2px",display:"flex",justifyContent:"end",margin:"0"},children:[(0,a.jsx)(i.ZP,{className:"font-semibold border-transparent group",type:"link",htmlType:"submit",icon:(0,a.jsx)(V.l_A,{className:"group-hover:text-green-500"})}),(0,a.jsx)(i.ZP,{className:"font-semibold border-transparent group",type:"link",onClick:()=>{y(l)},icon:(0,a.jsx)(L.bjh,{className:"group-hover:text-red-500"})})]})]}):(0,a.jsxs)("strong",{className:"flex gap-2 items-center",children:[e,(0,a.jsx)(i.ZP,{type:"link",onClick:()=>{x(l)},icon:(0,a.jsx)(O.FNg,{})}),(0,a.jsx)(i.ZP,{className:"  text-xs text-red-500 font-semibold",type:"text",onClick:()=>F(null==t?void 0:t.package_id),children:"X\xf3a"})]})})}],S=async e=>{try{let t=await _(()=>v.Z.createTypePackage(e));201===t&&(p((0,U.v)()),N.resetFields())}catch(e){console.error("Error creating :",e)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.ZP,{hidden:!!t,className:"bg-blue-400 border-0 text-white font-semibold",onClick:()=>{n(!0)},ref:t,children:"G\xf3i b\xe1o gi\xe1"}),(0,a.jsx)(d.Z,{title:"G\xf3i b\xe1o gi\xe1",open:l,onCancel:()=>{n(!1)},footer:null,width:"100%",style:{maxWidth:"800px"},children:(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)(i.ZP,{className:"bg-orange-500 text-white font-semibold",icon:(0,a.jsx)(q.gyF,{}),onClick:()=>{N.resetFields(),j(!w)}}),(0,a.jsx)("div",{className:"bg-slate-200 px-1 py-2 rounded-md",hidden:!w,children:(0,a.jsxs)(C.Z,{form:N,onFinish:S,style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:[(0,a.jsx)(C.Z.Item,{name:"name_package",rules:[{required:!0,message:"Vui l\xf2ng nhập t\xean xuất xứ"}],style:{flex:"1 1 0%",margin:"0"},children:(0,a.jsx)(f.default,{placeholder:"Nhập t\xean loại"})}),(0,a.jsx)(C.Z.Item,{style:{display:"flex",justifyContent:"end",margin:"0"},children:(0,a.jsx)(i.ZP,{className:"bg-green-500 text-white font-semibold",onClick:()=>{N.submit()},children:"Th\xeam"})})]})}),(0,a.jsx)("div",{className:"border-t-2 w-full overflow-x-auto",children:(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)(c.Z,{columns:k,scroll:{x:"max-content"},className:"custom-table",dataSource:h,pagination:{pageSize:10,showTotal:(e,t)=>"".concat(t[0],"-").concat(t[1]," of ").concat(e," items")},showSorterTooltip:{target:"sorter-icon"}})})})]})}),(0,a.jsx)(d.Z,{open:""!==Z,title:"X\xf3a dữ liệu",onOk:T,onCancel:()=>{F("")},children:"Bạn c\xf3 chắc chắn muốn x\xf3a kh\xf4ng ?"})]})};let{RangePicker:R}=j.default;function G(){let[e,t]=(0,r.useState)({}),{customerID:l,projectID:n}=(0,E.useParams)(),d=(0,u.I0)();(0,r.useEffect)(()=>{e&&d((0,A.j)({...e,project:n}))},[e]);let{datas:c}=(0,u.v9)(e=>e.get_users),{datas:s}=(0,u.v9)(e=>e.get_projects),[p,h]=(0,r.useState)([]);return(0,r.useEffect)(()=>{if(s){var e;h(null!==(e=s.map(e=>{var t;return{value:e.project_id,label:null!==(t=e.name)&&void 0!==t?t:""}}))&&void 0!==e?e:[])}},[s]),(0,a.jsxs)("div",{className:"flex items-start gap-4 w-full flex-col",children:[(0,a.jsxs)("div",{className:"flex gap-2 items-center flex-wrap",children:[(0,a.jsx)(B.Z,{}),(0,a.jsx)(M,{}),(0,a.jsx)(z.default,{href:"/price_quote/kanban",hidden:!!l,children:(0,a.jsx)(i.ZP,{icon:(0,a.jsx)(W.DDi,{})})})]}),(0,a.jsx)("p",{className:"text-sm font-semibold text-[#1BA399]",children:"Được lọc theo:"}),(0,a.jsxs)("div",{className:"flex flex-wrap w-full items-center justify-end gap-2   pb-4 ",children:[!n&&(0,a.jsx)(o.Z,{placeholder:"Dự \xe1n",style:{minWidth:120,flex:"1 1 0%"},onChange:l=>{t({...e,project:l})},options:p}),(0,a.jsx)(o.Z,{placeholder:"Ng\xe0y",style:{minWidth:120,flex:"1 1 0%"},onChange:l=>{t({...e,type_date:l})},options:[{value:"0",label:"Ng\xe0y đề xuất"},{value:"1",label:"Ng\xe0y hết hạn"}]}),(0,a.jsx)(R,{style:{minWidth:120,flex:"1 1 0%"},onChange:(l,a)=>{console.log("thay doi",a),""!==a[0]?t({...e,date_start:a[0],date_expired:a[1]}):d((0,A.j)({}))}}),(0,a.jsx)(o.Z,{placeholder:"T\xecnh trạng",onChange:l=>{t({...e,status:l})},style:{minWidth:120,flex:"1 1 0%"},options:[{value:"draff",label:"Draff"},{value:"send",label:"Send"},{value:"open",label:"Open"},{value:"edit",label:"Edit"},{value:"refuse",label:"Refuse"},{value:"accept",label:"Accept"}]}),(0,a.jsx)(o.Z,{placeholder:"Người phụ tr\xe1ch",showSearch:!0,filterOption:(e,t)=>{var l,a;return(null!==(a=null==t?void 0:null===(l=t.children)||void 0===l?void 0:l.join(""))&&void 0!==a?a:"").toLowerCase().includes(e.toLowerCase())},onChange:l=>{t({...e,user_support:l})},style:{minWidth:120,flex:"1 1 0%"},children:null==c?void 0:c.map(e=>(0,a.jsxs)(_.W,{value:e.user_id,children:[e.first_name," ",e.last_name]},e.user_id))})]})]})}function J(){let e=(0,I.Z)(["admin-top","price_quote","price_quote-edit"]);return(0,a.jsxs)("div",{className:"flex flex-col gap-4 rounded-md p-4 shadow-[0_8px_30px_rgb(0,0,0,0.12)] bg-white",children:[e&&(0,a.jsx)("div",{className:"rounded-md",children:(0,a.jsx)(G,{})}),(0,a.jsx)("div",{className:"rounded-md",children:(0,a.jsx)(D,{})})]})}},32479:function(e,t,l){"use strict";l.d(t,{v:function(){return i}});var a=l(64439),r=l(20301);let i=(0,r.hg)("product/fetchProductOriginals",async(e,t)=>{try{return await a.Z.getTypePackages()}catch(e){return t.rejectWithValue("Failed to fetch product types")}}),n=(0,r.oM)({name:"type_package",initialState:{datas:[],loading:!1,error:null},reducers:{},extraReducers:e=>{e.addCase(i.pending,e=>{e.loading=!0,e.error=null}).addCase(i.fulfilled,(e,t)=>{200===t.payload.statusCode&&(e.loading=!1,e.datas=t.payload.data)}).addCase(i.rejected,(e,t)=>{e.loading=!1,e.error=t.payload})}}).reducer;t.Z=n},90987:function(e,t,l){"use strict";var a=l(28223),r=l(7261);t.Z={getProducts:async()=>(await a.Z.get("/product/all")).data,deleteProducts:async e=>(await a.Z.delete("/product",{data:e})).data,getWarrantys:async()=>(await a.Z.get("/product/warranty")).data,getWarrantiesByAsset:async e=>(await a.Z.get("/product/warranty-by-asset/".concat(e))).data,getWarrantiesByCode:async e=>(await a.Z.get("/product/warranty-by-code/".concat(e))).data,createWarranty:async e=>(await a.Z.post("/product/warranty",e)).data,updateWarranty:async(e,t)=>(await a.Z.put("/product/warranty/".concat(e),t)).data,deleteWarranty:async e=>(await a.Z.delete("/product/warranty/".concat(e))).data,getAboutProduct:async()=>(await a.Z.get("/product/about")).data,getProductID:async e=>(await a.Z.get("/product/id/".concat(e))).data,getProductsID:async e=>(await a.Z.get("/product/code/all/".concat(e))).data,getWarrantyID:async e=>(await a.Z.get("/product/warranty/".concat(e))).data,deletePictureProduct:async e=>(await a.Z.delete("/product/picture",{data:e})).data,getUnits:async()=>(await a.Z.get("/product/unit")).data,deleteUnits:async e=>(await a.Z.delete("/product/unit",{data:e})).data,deleteBrands:async e=>(await a.Z.delete("/product/brand",{data:e})).data,deleteTypes:async e=>(await a.Z.delete("/product/type",{data:e})).data,deleteClassifyType:async e=>(await a.Z.delete("/product/classify_type",{data:e})).data,deleteOriginal:async e=>(await a.Z.delete("/product/original",{data:e})).data,getTypes:async()=>(await a.Z.get("/product/type")).data,createType:async e=>{let t=await a.Z.post("/product/type",e);if(!t)throw Error("Failed to create type product: No response");return t.data},getClassifies:async()=>(await a.Z.get("/product/classify_type")).data,getNameClassifies:async()=>(await a.Z.get("/product/classify_type_name/expense")).data,createClassify:async e=>{let t=await a.Z.post("/product/classify_type",e);if(!t)throw Error("Failed to create classify_type product: No response");return t.data},updateClassify:async(e,t)=>{let l=await a.Z.put("/product/classify_type/".concat(e),t);if(!l)throw Error("Failed to update classify_type product: No response");return l.data},getBrands:async()=>(await a.Z.get("/product/brand")).data,createBrand:async e=>{let t=await a.Z.post("/product/brand",e);if(!t)throw Error("Failed to create brand product: No response");return t.data},updateBrand:async(e,t)=>{let l=await a.Z.put("/product/brand/".concat(e),{name:t});if(!l)throw Error("Failed to update brand product: No response");return l.data},getOriginals:async()=>(await a.Z.get("/product/original")).data,createOriginal:async e=>{let t=await a.Z.post("/product/original",e);if(!t)throw Error("Failed to create original product: No response");return t.data},updateOriginal:async(e,t)=>{let l=await a.Z.put("/product/original/".concat(e),{name:t});if(!l)throw Error("Failed to update original product: No response");return l.data},createUnit:async e=>{let t=await a.Z.post("/product/unit",e);if(!t)throw Error("Failed to create unit product: No response");return t.data},updateUnit:async(e,t)=>{let l=await a.Z.put("/product/unit/".concat(e),{name_unit:t});if(!l)throw Error("Failed to update unit product: No response");return l.data},updateType:async(e,t)=>{let l=await a.Z.put("/product/type/".concat(e),t);if(!l)throw Error("Failed to update unit product: No response");return l.data},createProduct:async e=>{let t=await a.Y.post("/product/new",e);if(!t)throw Error("Failed to create product: No response");return t.data},getCodeID:async e=>{try{let t=await a.Z.get("/product/code_url?url=".concat(e));if(!t)throw Error("Failed to create product: No response");return 200!==t.data.statusCode&&r.Am.error(t.data.message),t.data}catch(e){r.Am.error("Sản phẩm đ\xe3 xuất kho hoặc kh\xf4ng tồn tại")}},getCodeStatusByURL:async e=>{try{let t=await a.Z.get("/product/status-code_url?url=".concat(e));if(!t)throw Error("Failed to create product: No response");return 200!==t.data.statusCode&&r.Am.error(t.data.message),t.data}catch(e){r.Am.error("Sản phẩm đ\xe3 xuất kho hoặc kh\xf4ng tồn tại")}},createCodeProduct:async e=>{let t=await a.Z.post("/product/code",{product:e});if(!t)throw Error("Failed to create product: No response");return t.data},getCodeProduct:async()=>{let e=await a.Z.get("/product/code");if(!e)throw Error("Failed to create product: No response");return e.data},updateProductInfo:async(e,t,l)=>{let r=await a.Y.put("/product/id/".concat(e),t);if(l.length>0&&await a.Z.delete("/product/picture",{data:l}),!r)throw Error("Failed to create product: No response");return r.data},updateStatusProduct:async(e,t)=>{let l=await a.Z.put("/product/status/id/".concat(e),{status:t});if(!l)throw Error("Failed to update product: No response");return l.data},pushImageProduct:async e=>{let t=await a.Y.post("/product/picture/push",e);if(!t)throw Error("Failed to create product: No response");return t.data},createSupplier:async e=>{let t=await a.Z.post("/product/supplier",e);if(!t)throw Error("Failed to create supplier product: No response");return t.data},deleteSupplier:async e=>(await a.Z.delete("/product/supplier",{data:e})).data,getAllSuppliers:async()=>{let e=await a.Z.get("/product/supplier");if(!e)throw Error("Failed to fetch suppliers: No response");return e.data},getSupplierById:async e=>{let t=await a.Z.get("/product/supplier/".concat(e));if(!t)throw Error("Failed to fetch supplier with ID ".concat(e,": No response"));return t.data},updateSupplier:async(e,t)=>{let l=await a.Z.put("/product/supplier/".concat(e),t);if(!l)throw Error("Failed to update supplier with ID ".concat(e,": No response"));return l.data},createActivityContainer:async e=>{let t=await a.Z.post("/product/activity_container",e);if(!t)throw Error("Failed to create activity container: No response");return t.data},findAllActivityContainers:async e=>{let t=await a.Z.get("/product/activity_container?type=".concat(e));if(!t)throw Error("Failed to fetch activity containers: No response");return t.data},findActivityContainerById:async e=>{let t=await a.Z.get("/product/activity_container/".concat(e));if(!t)throw Error("Failed to fetch activity container with ID ".concat(e,": No response"));return t.data},updateActivityContainer:async(e,t)=>{let l=await a.Z.put("/product/activity_container/".concat(e),t);if(!l)throw Error("Failed to update activity container with ID ".concat(e,": No response"));return l.data},findCodeByID:async e=>{let t=await a.Z.get("/product/product-code/".concat(e));if(!t)throw Error("Failed to fetch activity container with ID ".concat(e,": No response"));return t.data},findAssetByCode:async e=>{let t=await a.Z.get("/product/asset-code/".concat(e));if(!t)throw Error("Failed to fetch activity container with ID ".concat(e,": No response"));return t.data},createReport:async(e,t)=>{let l=await a.Z.post("/product/report",{description:e,code_product:t});if(!l)throw Error("Failed to fetch activity container with ID: No response");return l.data},updateReportStatus:async(e,t)=>{let l=await a.Z.put("/product/report-status/".concat(e),{status:t});if(!l)throw Error("Failed to fetch activity container with ID: No response");return l.data},findAllReportByCode:async e=>{let t=await a.Z.get("/product/report-code/".concat(e));if(!t)throw Error("Failed to fetch activity container with ID ".concat(e,": No response"));return t.data},findAllCommentByReport:async e=>{let t=await a.Z.get("/product/comment-report/".concat(e));if(!t)throw Error("Failed to fetch activity container with ID ".concat(e,": No response"));return t.data},findAllCommentByCode:async e=>{let t=await a.Z.get("/product/comment-report/".concat(e));if(!t)throw Error("Failed to fetch activity container with ID ".concat(e,": No response"));return t.data},toggleLikeReport:async(e,t)=>{if(e){let e=await a.Z.delete("/product/like-report/".concat(t));if(!e)throw Error("Failed to fetch activity container with ID  No response");return e.data}{let e=await a.Z.post("/product/like-report",{history_report:t});if(!e)throw Error("Failed to fetch activity container with ID  No response");return e.data}},createCommentReport:async e=>{let t=await a.Z.post("/product/comment-report",e);if(!t)throw Error("Failed to fetch activity container with ID  No response");return t.data},deleteCommentReport:async e=>{let t=await a.Z.delete("/product/comment-report/".concat(e));if(!t)throw Error("Failed to fetch activity container with ID  No response");return t.data},findAllHistoryByCode:async e=>{let t=await a.Z.get("/product/history-code/".concat(e));if(!t)throw Error("Failed to fetch activity container with ID ".concat(e,": No response"));return t.data},findProductByType:async e=>{let t=new URLSearchParams;e&&Object.entries(e).forEach(e=>{let[l,a]=e;null!=a&&t.append(l,a.toString())});let l=await a.Z.get("/product/get-products?".concat(t.toString()));if(!l)throw Error("Failed to fetch product");return l.data},createAsset:async e=>{let t=await a.Z.post("/product/asset",e);if(!t)throw Error("Failed to create product: No response");return t.data},updateAsset:async(e,t)=>{let l=await a.Z.put("/product/asset/".concat(e),t);if(!l)throw Error("Failed to create product: No response");return l.data},getAssets:async()=>{let e=await a.Z.get("/product/assets");if(!e)throw Error("Failed to create product: No response");return e.data},getAssetsByProject:async e=>{let t=await a.Z.get("/product/assets-by-project/".concat(e));if(!t)throw Error("Failed to create product: No response");return t.data},getAssetByID:async e=>{let t=await a.Z.get("/product/asset/".concat(e));if(!t)throw Error("Failed to create product: No response");return t.data},findAllHistoryAssetByID:async e=>{let t=await a.Z.get("/product/history-asset/".concat(e));if(!t)throw Error("Failed to fetch activity container with ID ".concat(e,": No response"));return t.data}}},94062:function(){}}]);